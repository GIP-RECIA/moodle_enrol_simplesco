{"version":3,"sources":["../src/unenrolment.js"],"names":["SELECTORS","BUTTON_TRIGGER","BUTTON_LOADMORE","BUTTON_UNENROL","BUTTON_UNENROL_ALL","FIELD_ENTITY","AREA_RESULTS","ESCOUnenrolment","options","course_id","instance","init","prototype","modal","page","perpage","unenrol_count","require_refresh","$","when","Str","get_strings","component","key","ModalFactory","create","type","types","DEFAULT","large","then","strings","setTitle","body","setBody","setFooter","getRoot","on","ModalEvents","hidden","location","reload","bindEvents","search","bind","fail","Notification","exception","show","getBody","find","event","preventDefault","getFooter","confirm","unenrolall","itemid","attr","unenrol","append","action","val","parameters","id","sesskey","M","cfg","enrolcount","enrol_count","enrolid","remove","ajax","url","wwwroot","method","dataType","data","build_querystring","success","result","error","string_total_item","replace","response","totalusers","totalcohorts","html","line","cohorts","cohort","renderCohort","users","user","renderUser","count","length","resultat","statut","erreur","beforeSend","startLoading","always","stopLoading","cohort_html","name","user_html","picture","fullname","extrafields","hide","addClass","config"],"mappings":"qOAOA,OACA,OACA,OACA,OACA,O,mEAEMA,CAAAA,CAAS,CAAG,CACdC,cAAc,CAAE,kEADF,CAEdC,eAAe,CAAE,mCAFH,CAGdC,cAAc,CAAE,iCAHF,CAIdC,kBAAkB,CAAE,qCAJN,CAKdC,YAAY,CAAE,wBALA,CAMdC,YAAY,CAAE,aANA,C,CASZC,CAAe,CAAG,SAACC,CAAD,CAAa,CACjC,CAAI,CAACC,SAAL,CAAiBD,CAAO,CAACC,SAAzB,CACA,CAAI,CAACC,QAAL,CAAgBF,CAAO,CAACE,QAAxB,CACA,CAAI,CAACC,IAAL,EACH,C,CAGDJ,CAAe,CAACK,SAAhB,CAA0BC,KAA1B,CAAkC,IAAlC,CAEAN,CAAe,CAACK,SAAhB,CAA0BE,IAA1B,CAAiC,CAAjC,CAEAP,CAAe,CAACK,SAAhB,CAA0BG,OAA1B,CAAoC,EAApC,CAEAR,CAAe,CAACK,SAAhB,CAA0BH,SAA1B,CAAsC,CAAtC,CAEAF,CAAe,CAACK,SAAhB,CAA0BI,aAA1B,CAA0C,CAA1C,CAEAT,CAAe,CAACK,SAAhB,CAA0BF,QAA1B,CAAqC,EAArC,CAEAH,CAAe,CAACK,SAAhB,CAA0BK,eAA1B,IAGAV,CAAe,CAACK,SAAhB,CAA0BC,KAA1B,CAAkC,IAAlC,CAEAN,CAAe,CAACK,SAAhB,CAA0BD,IAA1B,CAAiC,UAAM,CAEnCO,UAAEC,IAAF,CACIC,UAAIC,WAAJ,CAAgB,CACZ,CAACC,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,cAApC,CADY,CAEZ,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,eAApC,CAFY,CAGZ,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,UAApC,CAHY,CAIZ,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,aAApC,CAJY,CAKZ,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,eAApC,CALY,CAMZ,CAACD,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,iBAA1B,CANY,CAOZ,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,kBAApC,CAPY,CAQZ,CAACD,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,YAA1B,CARY,CASZ,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,cAApC,CATY,CAAhB,CADJ,CAYIC,UAAaC,MAAb,CAAoB,CAChBC,IAAI,CAAEF,UAAaG,KAAb,CAAmBC,OADT,CAEhBC,KAAK,GAFW,CAApB,QAZJ,EAgBEC,IAhBF,CAgBO,SAAUC,CAAV,CAAmBlB,CAAnB,CAA0B,CAC7B,KAAKkB,OAAL,CAAeA,CAAf,CACA,KAAKlB,KAAL,CAAaA,CAAb,CAEAA,CAAK,CAACmB,QAAN,CAAeD,CAAO,CAAC,CAAD,CAAtB,EAGA,GAAIE,CAAAA,CAAI,CAAG,6CAAX,CAEAA,CAAI,EAAI,gCAAR,CACAA,CAAI,EAAI,iCAAR,CACAA,CAAI,EAAI,qFAA+EF,CAAO,CAAC,CAAD,CAAtF,CAA4F,UAApG,CACAE,CAAI,EAAI,mEAA+DF,CAAO,CAAC,CAAD,CAAtE,CAA4E,UAApF,CACAE,CAAI,EAAI,QAAR,CACAA,CAAI,EAAI,QAAR,CAEAA,CAAI,EAAI,4BAAR,CAEAA,CAAI,EAAI,8DAAR,CAEAA,CAAI,EAAI,QAAR,CACApB,CAAK,CAACqB,OAAN,CAAcD,CAAd,EAEApB,CAAK,CAACsB,SAAN,CAAgB,iEAA+DJ,CAAO,CAAC,CAAD,CAAtE,CACV,kEADU,CACuDA,CAAO,CAAC,CAAD,CAD9D,CACoE,WADpF,EAGAlB,CAAK,CAACuB,OAAN,GAAgBC,EAAhB,CAAmBC,UAAYC,MAA/B,CAAuC,UAAM,CACzC,GAAI,SAAQtB,eAAZ,CAA6B,CACzBuB,QAAQ,CAACC,MAAT,EACH,CACJ,CAJD,EAMA,KAAKC,UAAL,GACA,KAAKC,MAAL,EACH,CAlCM,CAkCLC,IAlCK,CAkCA,CAlCA,CAhBP,EAkDcC,IAlDd,CAkDmBC,UAAaC,SAlDhC,CAmDH,CArDD,CA0DAxC,CAAe,CAACK,SAAhB,CAA0B8B,UAA1B,CAAuC,UAAM,CAEzC,cAAE,MAAF,EAAUL,EAAV,CAAa,OAAb,CAAsBrC,CAAS,CAACC,cAAhC,CAAgD,UAAM,CAClD,SAAQY,KAAR,CAAcmC,IAAd,EACH,CAFD,EAIA,CAAI,CAACnC,KAAL,CAAWoC,OAAX,GAAqBC,IAArB,CAA0BlD,CAAS,CAACK,YAApC,EAAkDgC,EAAlD,CAAqD,QAArD,CAA+D,UAAe,CAC1E,SAAQM,MAAR,EACH,CAFD,EAIA,CAAI,CAAC9B,KAAL,CAAWoC,OAAX,GAAqBZ,EAArB,CAAwB,OAAxB,CAAiCrC,CAAS,CAACE,eAA3C,CAA4D,SAACiD,CAAD,CAAW,CACnEA,CAAK,CAACC,cAAN,GACA,SAAQT,MAAR,KACA,QACH,CAJD,EAMA,CAAI,CAAC9B,KAAL,CAAWwC,SAAX,GAAuBhB,EAAvB,CAA0B,OAA1B,CAAmCrC,CAAS,CAACI,kBAA7C,CAAiE,SAAC+C,CAAD,CAAW,CACxEA,CAAK,CAACC,cAAN,GACA,GAAIE,OAAO,CAAC,uFAAD,CAAX,CAAmG,CAC/F,SAAQC,UAAR,EACH,CACD,QACH,CAND,EAQA,CAAI,CAAC1C,KAAL,CAAWoC,OAAX,GAAqBC,IAArB,CAA0BlD,CAAS,CAACM,YAApC,EAAkD+B,EAAlD,CAAqD,OAArD,CAA8DrC,CAAS,CAACG,cAAxE,CAAuF,SAACgD,CAAD,CAAW,CAC9FA,CAAK,CAACC,cAAN,GACA,GAAMI,CAAAA,CAAM,CAAG,cAAE,CAAF,EAAQC,IAAR,CAAa,OAAb,CAAf,CACA,SAAQC,OAAR,CAAgBF,CAAhB,EACA,QACH,CALD,CAMH,CA9BD,CAkCAjD,CAAe,CAACK,SAAhB,CAA0B+B,MAA1B,CAAmC,SAACgB,CAAD,CAAY,CAG3C,GAAIA,CAAJ,CAAY,CACR,CAAI,CAAC7C,IAAL,EACH,CAFD,IAEO,CACH,CAAI,CAACA,IAAL,CAAY,CACf,CAED,GAAI8C,CAAAA,CAAM,CAAG,kBAAb,CACA,GAA6E,SAAzE,GAAA,CAAI,CAAC/C,KAAL,CAAWoC,OAAX,GAAqBC,IAArB,CAA0BlD,CAAS,CAACK,YAAV,CAAyB,UAAnD,EAA+DwD,GAA/D,EAAJ,CAAwF,CACpFD,CAAM,CAAG,oBACZ,CAED,GAAME,CAAAA,CAAU,CAAG,CACfC,EAAE,CAAE,CAAI,CAACtD,SADM,CAEfuD,OAAO,CAAEC,CAAC,CAACC,GAAF,CAAMF,OAFA,CAGfJ,MAAM,CAAEA,CAHO,CAIf9C,IAAI,CAAE,CAAI,CAACA,IAJI,CAKfC,OAAO,CAAE,CAAI,CAACA,OALC,CAMfoD,UAAU,CAAE,CAAI,CAACC,WANF,CAOfC,OAAO,CAAE,CAAI,CAAC3D,QAAL,CAAcqD,EAPR,CAAnB,CAUA,SAAQlD,KAAR,CAAcoC,OAAd,GAAwBC,IAAxB,CAA6BlD,CAAS,CAACM,YAAvC,EAAqD4C,IAArD,CAA0D,mCAA1D,EAA6FoB,MAA7F,GACApD,UAAEqD,IAAF,CAAO,CACHC,GAAG,CAAEP,CAAC,CAACC,GAAF,CAAMO,OAAN,CAAgB,2BADlB,CAEHC,MAAM,CAAE,MAFL,CAGHC,QAAQ,CAAE,MAHP,CAIHC,IAAI,CAAEC,iBAAiB,CAACf,CAAD,CAJpB,CAKHgB,OAAO,CAAE,iBAACC,CAAD,CAAY,CACjB,GAAIA,CAAM,CAACC,KAAX,CAAkB,CACd,MAAOlC,WAAaC,SAAb,CAAuBgC,CAAvB,CACV,CACD,GAAIE,CAAAA,CAAiB,CAAG,SAAQlD,OAAR,CAAgB,CAAhB,EAAmBmD,OAAnB,CAA2B,MAA3B,CAAmCH,CAAM,CAACI,QAAP,CAAgBC,UAAnD,CAAxB,CACA,GAAe,oBAAX,GAAAxB,CAAJ,CAAqC,CACjCqB,CAAiB,CAAG,SAAQlD,OAAR,CAAgB,CAAhB,EAAmBmD,OAAnB,CAA2B,MAA3B,CAAmCH,CAAM,CAACI,QAAP,CAAgBE,YAAnD,CACvB,CAED,GAAI,CAAC1B,CAAL,CAAa,CACT,SAAQ9C,KAAR,CAAcoC,OAAd,GAAwBC,IAAxB,CAA6BlD,CAAS,CAACM,YAAvC,EAAqDgF,IAArD,CAA0D,EAA1D,EACA,SAAQzE,KAAR,CAAcoC,OAAd,GAAwBC,IAAxB,CAA6BlD,CAAS,CAACM,YAAvC,EAAqDqD,MAArD,CAA4D,gCAAgCsB,CAAhC,CACtD,QADN,CAEH,CACD,GAAe,oBAAX,GAAArB,CAAJ,CAAqC,CACjC,IAAK,GAAI2B,CAAAA,CAAT,GAAiBR,CAAAA,CAAM,CAACI,QAAP,CAAgBK,OAAjC,CAA0C,CACtC,GAAMC,CAAAA,CAAM,CAAGV,CAAM,CAACI,QAAP,CAAgBK,OAAhB,CAAwBD,CAAxB,CAAf,CACA,SAAQ1E,KAAR,CAAcoC,OAAd,GAAwBC,IAAxB,CAA6BlD,CAAS,CAACM,YAAvC,EAAqDqD,MAArD,CAA4D,SAAQ+B,YAAR,CAAqBD,CAArB,CAA5D,CACH,CACJ,CALD,IAKO,CACH,IAAK,GAAIF,CAAAA,CAAT,GAAiBR,CAAAA,CAAM,CAACI,QAAP,CAAgBQ,KAAjC,CAAwC,CACpC,GAAMC,CAAAA,CAAI,CAAGb,CAAM,CAACI,QAAP,CAAgBQ,KAAhB,CAAsBJ,CAAtB,CAAb,CACA,SAAQ1E,KAAR,CAAcoC,OAAd,GAAwBC,IAAxB,CAA6BlD,CAAS,CAACM,YAAvC,EAAqDqD,MAArD,CAA4D,SAAQkC,UAAR,CAAmBD,CAAnB,CAA5D,CACH,CACJ,CACD,GAAME,CAAAA,CAAK,CAAG,SAAQjF,KAAR,CAAcoC,OAAd,GAAwBC,IAAxB,CAA6BlD,CAAS,CAACM,YAAvC,EAAqD4C,IAArD,CAA0D,OAA1D,EAAmE6C,MAAjF,CACA,GAAID,CAAK,CAAGf,CAAM,CAACI,QAAP,CAAgBC,UAA5B,CAAwC,CACpC,SAAQvE,KAAR,CAAcoC,OAAd,GAAwBC,IAAxB,CAA6BlD,CAAS,CAACM,YAAvC,EACKqD,MADL,CACY,4FACF,SAAQ5B,OAAR,CAAgB,CAAhB,CADE,CACmB,iBAF/B,CAGH,CACJ,CApCE,CAqCHiD,KAAK,CAAE,eAACgB,CAAD,CAAWC,CAAX,CAAmBC,CAAnB,CAA8B,CACjCpD,UAAaC,SAAb,CAAuBmD,CAAvB,CACH,CAvCE,CAwCHC,UAAU,CAAE,qBAAM,CACd,SAAQC,YAAR,EACH,CA1CE,CAAP,EA2CGC,MA3CH,CA2CU,UAAM,CACZ,SAAQC,WAAR,EACH,CA7CD,CA8CH,CAvED,CA6EA/F,CAAe,CAACK,SAAhB,CAA0B8E,YAA1B,CAAyC,SAACD,CAAD,CAAY,IAC3CK,CAAAA,CAAK,CAAG,CAAI,CAACjF,KAAL,CAAWoC,OAAX,GAAqBC,IAArB,CAA0BlD,CAAS,CAACM,YAApC,EAAkD4C,IAAlD,CAAuD,SAAvD,EAAkE6C,MAD/B,CAE7CQ,CAAW,CAAG,6CAA4Cd,CAAM,CAAC1B,EAAnD,CAAwD,KAFzB,CAIjDwC,CAAW,EAAI,yBAAyBT,CAAK,CAAG,CAAjC,EAAsC,QAArD,CAEAS,CAAW,EAAI,yBAAf,CACAA,CAAW,EAAI,2BAA2Bd,CAAM,CAACe,IAAlC,CAAyC,QAAxD,CACAD,CAAW,EAAI,QAAf,CAEAA,CAAW,EAAI,yBAAf,CACAA,CAAW,EAAI,qEAAkEd,CAAM,CAAC1B,EAAzE,CAA8E,KAA9E,CAAqF,CAAI,CAAChC,OAAL,CAAa,CAAb,CAArF,CACT,WADN,CAEAwE,CAAW,EAAI,QAAf,CAEAA,CAAW,EAAI,QAAf,CAEA,MAAOA,CAAAA,CACV,CAlBD,CAwBAhG,CAAe,CAACK,SAAhB,CAA0BiF,UAA1B,CAAuC,SAACD,CAAD,CAAU,IACvCE,CAAAA,CAAK,CAAG,CAAI,CAACjF,KAAL,CAAWoC,OAAX,GAAqBC,IAArB,CAA0BlD,CAAS,CAACM,YAApC,EAAkD4C,IAAlD,CAAuD,OAAvD,EAAgE6C,MADjC,CAEzCU,CAAS,CAAG,2CAA0Cb,CAAI,CAAC7B,EAA/C,CAAoD,KAFvB,CAI7C0C,CAAS,EAAI,yBAAyBX,CAAK,CAAG,CAAjC,EAAsC,QAAnD,CACAW,CAAS,EAAI,0BAA0Bb,CAAI,CAACc,OAA/B,CAAyC,QAAtD,CAEAD,CAAS,EAAI,yBAAb,CACAA,CAAS,EAAI,2BAA2Bb,CAAI,CAACe,QAAhC,CAA2C,QAAxD,CACAF,CAAS,EAAI,8BAA8Bb,CAAI,CAACgB,WAAnC,CAAiD,QAA9D,CACAH,CAAS,EAAI,QAAb,CAEAA,CAAS,EAAI,yBAAb,CACAA,CAAS,EAAI,qEAAiEb,CAAI,CAAC7B,EAAtE,CAAyE,KAAzE,CAAgF,CAAI,CAAChC,OAAL,CAAa,CAAb,CAAhF,CAAkG,WAA/G,CACA0E,CAAS,EAAI,QAAb,CAEAA,CAAS,EAAI,QAAb,CAEA,MAAOA,CAAAA,CACV,CAnBD,CAwBAlG,CAAe,CAACK,SAAhB,CAA0BwF,YAA1B,CAAyC,UAAM,CAC3C,CAAI,CAACvF,KAAL,CAAWoC,OAAX,GAAqBC,IAArB,CAA0B,UAA1B,EAAsCF,IAAtC,EACH,CAFD,CAOAzC,CAAe,CAACK,SAAhB,CAA0B0F,WAA1B,CAAwC,UAAM,CAC1C,CAAI,CAACzF,KAAL,CAAWoC,OAAX,GAAqBC,IAArB,CAA0B,UAA1B,EAAsC2D,IAAtC,EACH,CAFD,CAOAtG,CAAe,CAACK,SAAhB,CAA0B8C,OAA1B,CAAoC,SAACF,CAAD,CAAY,IAEtCM,CAAAA,CAAU,CAAG,CACfC,EAAE,CAAE,CAAI,CAACtD,SADM,CAEfuD,OAAO,CAAEC,CAAC,CAACC,GAAF,CAAMF,OAFA,CAGfJ,MAAM,CAAE,aAHO,CAIfS,OAAO,CAAE,CAAI,CAAC3D,QAAL,CAAcqD,EAJR,CAFyB,CAS5C,GAA6E,SAAzE,GAAA,CAAI,CAAClD,KAAL,CAAWoC,OAAX,GAAqBC,IAArB,CAA0BlD,CAAS,CAACK,YAAV,CAAyB,UAAnD,EAA+DwD,GAA/D,EAAJ,CAAwF,CACpFC,CAAU,SAAV,CAAyBN,CAAzB,CACAM,CAAU,OAAV,CAAuB,eAC1B,CAHD,IAGK,CACDA,CAAU,OAAV,CAAuBN,CAAvB,CACAM,CAAU,OAAV,CAAuB,aAC1B,CAGD5C,UAAEqD,IAAF,CAAO,CACHC,GAAG,CAAEP,CAAC,CAACC,GAAF,CAAMO,OAAN,CAAgB,2BADlB,CAEHC,MAAM,CAAE,MAFL,CAGHC,QAAQ,CAAE,MAHP,CAIHC,IAAI,CAAEC,iBAAiB,CAACf,CAAD,CAJpB,CAKHgB,OAAO,CAAE,iBAACC,CAAD,CAAY,CACjB,GAAIA,CAAM,CAACC,KAAX,CAAkB,CACd,MAAOlC,WAAaC,SAAb,CAAuBgC,CAAvB,CACV,CACD,SAAQ9D,eAAR,IACA,SAAQD,aAAR,GACA,SAAQH,KAAR,CAAcoC,OAAd,GAAwBC,IAAxB,CAA6BlD,CAAS,CAACM,YAAvC,EAAqD4C,IAArD,CAA0D,kBAAmBM,CAAnB,CAA4B,KAAtF,EAA4FsD,QAA5F,CAAqG,UAArG,CACH,CAZE,CAaH9B,KAAK,CAAE,eAACgB,CAAD,CAAWC,CAAX,CAAmBC,CAAnB,CAA8B,CACjCpD,UAAaC,SAAb,CAAuBmD,CAAvB,CACH,CAfE,CAgBHC,UAAU,CAAG,qBAAM,CACf,SAAQC,YAAR,EACH,CAlBE,CAAP,EAmBGC,MAnBH,CAmBU,UAAM,CACZ,SAAQC,WAAR,EACH,CArBD,CAsBH,CAxCD,CA6CA/F,CAAe,CAACK,SAAhB,CAA0B2C,UAA1B,CAAuC,UAAM,IAErCO,CAAAA,CAAU,CAAG,CACbC,EAAE,CAAE,CAAI,CAACtD,SADI,CAEbuD,OAAO,CAAEC,CAAC,CAACC,GAAF,CAAMF,OAFF,CAGbJ,MAAM,CAAE,aAHK,CAIbS,OAAO,CAAE,CAAI,CAAC3D,QAAL,CAAcqD,EAJV,CAFwB,CASzC,GAA6E,SAAzE,GAAA,CAAI,CAAClD,KAAL,CAAWoC,OAAX,GAAqBC,IAArB,CAA0BlD,CAAS,CAACK,YAAV,CAAyB,UAAnD,EAA+DwD,GAA/D,EAAJ,CAAwF,CACpFC,CAAU,OAAV,CAAuB,kBAC1B,CAFD,IAEK,CACDA,CAAU,OAAV,CAAuB,gBAC1B,CAGD5C,UAAEqD,IAAF,CAAO,CACHC,GAAG,CAAEP,CAAC,CAACC,GAAF,CAAMO,OAAN,CAAgB,2BADlB,CAEHC,MAAM,CAAE,MAFL,CAGHC,QAAQ,CAAE,MAHP,CAIHC,IAAI,CAAEC,iBAAiB,CAACf,CAAD,CAJpB,CAKHgB,OAAO,CAAE,iBAACC,CAAD,CAAY,CACjB,GAAIA,CAAM,CAACC,KAAX,CAAkB,CACd,MAAOlC,WAAaC,SAAb,CAAuBgC,CAAvB,CACV,CACD,SAAQ9D,eAAR,IACA,SAAQ4F,IAAR,EACH,CAXE,CAYH7B,KAAK,CAAE,eAACgB,CAAD,CAAWC,CAAX,CAAmBC,CAAnB,CAA8B,CACjCpD,UAAaC,SAAb,CAAuBmD,CAAvB,CACH,CAdE,CAeHC,UAAU,CAAG,qBAAM,CACf,SAAQC,YAAR,EACH,CAjBE,CAAP,EAkBGC,MAlBH,CAkBU,UAAM,CACZ,SAAQC,WAAR,EACH,CApBD,CAqBH,CArCD,C,OAuCoB,QAAP3F,CAAAA,IAAO,CAAAoG,CAAM,CAAI,CACzB,GAAIxG,CAAAA,CAAJ,CAAoBwG,CAApB,CACJ,C","sourcesContent":["/**\n * ESCO Enrolment AMD module.\n *\n * @module     enrol_manual/quickenrolment\n * @copyright  2016 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport Str from 'core/str';\nimport Notification from 'core/notification';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\n\nconst SELECTORS = {\n    BUTTON_TRIGGER: \".enrolusersbutton.enrol_simplesco_plugin.unenrol [type='submit']\",\n    BUTTON_LOADMORE: 'button[data-toggle=\"load-more\"]',\n    BUTTON_UNENROL: 'button[data-toggle=\"unenrol\"]',\n    BUTTON_UNENROL_ALL: 'button[data-toggle=\"unenrol-all\"]',\n    FIELD_ENTITY: 'input[name=\"entity\"]',\n    AREA_RESULTS: \"div#results\",\n};\n\nconst ESCOUnenrolment = (options) => {\n    this.course_id = options.course_id;\n    this.instance = options.instance;\n    this.init();\n};\n\n/** @var {Modal} modal - */\nESCOUnenrolment.prototype.modal = null;\n/** @var {number} page - */\nESCOUnenrolment.prototype.page = 0;\n/** @var {number} perpage - */\nESCOUnenrolment.prototype.perpage = 25;\n/** @var {number} courseid - */\nESCOUnenrolment.prototype.course_id = 0;\n/** @var {boolean} enrol_count - */\nESCOUnenrolment.prototype.unenrol_count = 0;\n/** @var {array} instance - */\nESCOUnenrolment.prototype.instance = [];\n/** @var {boolean} require_refresh - */\nESCOUnenrolment.prototype.require_refresh = false;\n\n/** @var {Modal} modal */\nESCOUnenrolment.prototype.modal = null;\n\nESCOUnenrolment.prototype.init = () => {\n    const context = this;\n    $.when(\n        Str.get_strings([\n            {component: 'enrol_simplesco', key: 'unenroltitle'}, //0\n            {component: 'enrol_simplesco', key: 'btnunenrolall'},\n            {component: 'enrol_simplesco', key: 'btnclose'},\n            {component: 'enrol_simplesco', key: 'browseusers'},\n            {component: 'enrol_simplesco', key: 'browsecohorts'},\n            {component: 'enrol', key: 'ajaxxusersfound'},\n            {component: 'enrol_simplesco', key: 'ajaxxcohortfound'},\n            {component: 'enrol', key: 'ajaxnext25'},\n            {component: 'enrol_simplesco', key: 'unenrolusers'},\n        ]),\n        ModalFactory.create({\n            type: ModalFactory.types.DEFAULT,\n            large: true,\n        }, undefined)\n    ).then(function (strings, modal) {\n        this.strings = strings;\n        this.modal = modal;\n\n        modal.setTitle(strings[0]);\n\n\n        let body = '<div class=\"form-inline mform simplesco\">';\n\n        body += '<div class=\"search-control\">';\n        body += '<div class=\"entity-selector\">';\n        body += '<label><input type=\"radio\" name=\"entity\" value=\"users\" checked=\"checked\"/>' + strings[3] + '</label>';\n        body += '<label><input type=\"radio\" name=\"entity\" value=\"cohorts\"/>' + strings[4] + '</label>';\n        body += '</div>';\n        body += '</div>';\n\n        body += '<div id=\"results\"></div>';\n\n        body += '<div id=\"loading\" style=\"display:none;\">CHARGEMENT</div>';\n\n        body += '</div>';\n        modal.setBody(body);\n\n        modal.setFooter('<button class=\"btn btn-primary\" data-toggle=\"unenrol-all\">' + strings[1]\n            + '</button><button class=\"btn btn-primary\" data-action=\"hide\">' + strings[2] + '</button>');\n\n        modal.getRoot().on(ModalEvents.hidden, () => {\n            if (context.require_refresh) {\n                location.reload();\n            }\n        });\n\n        this.bindEvents();\n        this.search();\n    }.bind(this)).fail(Notification.exception);\n};\n\n/**\n * Bind events needed for the modal to work\n */\nESCOUnenrolment.prototype.bindEvents = () => {\n    const context = this;\n    $(\"body\").on(\"click\", SELECTORS.BUTTON_TRIGGER, () => {\n        context.modal.show();\n    });\n\n    this.modal.getBody().find(SELECTORS.FIELD_ENTITY).on(\"change\", (/*event*/) => {\n        context.search();\n    });\n\n    this.modal.getBody().on(\"click\", SELECTORS.BUTTON_LOADMORE, (event) => {\n        event.preventDefault();\n        context.search(true);\n        return false;\n    });\n\n    this.modal.getFooter().on(\"click\", SELECTORS.BUTTON_UNENROL_ALL, (event) => {\n        event.preventDefault();\n        if (confirm('Vous allez désinscrire tous les utilisateurs de ce cours ! Voulez-vous continuer ?')) {\n            context.unenrolall();\n        }\n        return false;\n    });\n\n    this.modal.getBody().find(SELECTORS.AREA_RESULTS).on(\"click\", SELECTORS.BUTTON_UNENROL,(event) => {\n        event.preventDefault();\n        const itemid = $(this).attr(\"value\");\n        context.unenrol(itemid);\n        return false;\n    });\n};\n/**\n * Send the send request to server(s) and then process the results\n */\nESCOUnenrolment.prototype.search = (append) => {\n    const context = this;\n\n    if (append) {\n        this.page++;\n    } else {\n        this.page = 0;\n    }\n\n    let action = \"searchusersenrol\";\n    if (this.modal.getBody().find(SELECTORS.FIELD_ENTITY + ':checked').val() === \"cohorts\") {\n        action = \"searchcohortsenrol\";\n    }\n\n    const parameters = {\n        id: this.course_id,\n        sesskey: M.cfg.sesskey,\n        action: action,\n        page: this.page,\n        perpage: this.perpage,\n        enrolcount: this.enrol_count,\n        enrolid: this.instance.id,\n    };\n\n    context.modal.getBody().find(SELECTORS.AREA_RESULTS).find('button[data-toggle=\"load-more\"]').remove();\n    $.ajax({\n        url: M.cfg.wwwroot + '/enrol/simplesco/ajax.php',\n        method: 'POST',\n        dataType: 'json',\n        data: build_querystring(parameters),\n        success: (result) => {\n            if (result.error) {\n                return Notification.exception(result);\n            }\n            let string_total_item = context.strings[5].replace(\"{$a}\", result.response.totalusers);\n            if (action === \"searchcohortsenrol\") {\n                string_total_item = context.strings[6].replace(\"{$a}\", result.response.totalcohorts);\n            }\n\n            if (!append) {\n                context.modal.getBody().find(SELECTORS.AREA_RESULTS).html(\"\");\n                context.modal.getBody().find(SELECTORS.AREA_RESULTS).append('<div class=\"total_results\">' + string_total_item\n                    + '</div>');\n            }\n            if (action === \"searchcohortsenrol\") {\n                for (let line in result.response.cohorts) {\n                    const cohort = result.response.cohorts[line];\n                    context.modal.getBody().find(SELECTORS.AREA_RESULTS).append(context.renderCohort(cohort));\n                }\n            } else {\n                for (let line in result.response.users) {\n                    const user = result.response.users[line];\n                    context.modal.getBody().find(SELECTORS.AREA_RESULTS).append(context.renderUser(user));\n                }\n            }\n            const count = context.modal.getBody().find(SELECTORS.AREA_RESULTS).find(\".item\").length;\n            if (count < result.response.totalusers) {\n                context.modal.getBody().find(SELECTORS.AREA_RESULTS)\n                    .append('<div class=\"text-center\"><button class=\"btn btn-secondary\" data-toggle=\"load-more\">'\n                        + context.strings[7] + '</button></div>');\n            }\n        },\n        error: (resultat, statut, erreur) => {\n            Notification.exception(erreur);\n        },\n        beforeSend: () => {\n            context.startLoading();\n        }\n    }).always(() => {\n        context.stopLoading();\n    });\n};\n\n/**\n * Render user data to HTML format\n * @param cohort\n */\nESCOUnenrolment.prototype.renderCohort = (cohort) => {\n    const count = this.modal.getBody().find(SELECTORS.AREA_RESULTS).find(\".cohort\").length;\n    let cohort_html = '<div class=\"cohort item clearfix\" rel=\"' + cohort.id + '\">';\n\n    cohort_html += '<div class=\"count\">' + (count + 1) + '</div>';\n\n    cohort_html += '<div class=\"details\">';\n    cohort_html += '<div class=\"fullname\">' + cohort.name + '</div>';\n    cohort_html += '</div>';\n\n    cohort_html += '<div class=\"options\">';\n    cohort_html += '<button class=\"btn btn-success\" data-toggle=\"unenrol\" value=\"' + cohort.id + '\">' + this.strings[8]\n        + '</button>';\n    cohort_html += '</div>';\n\n    cohort_html += '</div>';\n\n    return cohort_html;\n};\n\n/**\n * Render user data to HTML format\n * @param user\n */\nESCOUnenrolment.prototype.renderUser = (user) => {\n    const count = this.modal.getBody().find(SELECTORS.AREA_RESULTS).find(\".user\").length;\n    let user_html = '<div class=\"user item clearfix\" rel=\"' + user.id + '\">';\n\n    user_html += '<div class=\"count\">' + (count + 1) + '</div>';\n    user_html += '<div class=\"picture\">' + user.picture + '</div>';\n\n    user_html += '<div class=\"details\">';\n    user_html += '<div class=\"fullname\">' + user.fullname + '</div>';\n    user_html += '<div class=\"extrafields\">' + user.extrafields + '</div>';\n    user_html += '</div>';\n\n    user_html += '<div class=\"options\">';\n    user_html += '<button class=\"btn btn-success\" data-toggle=\"unenrol\" value=\"'+ user.id+'\">' + this.strings[8] + '</button>';\n    user_html += '</div>';\n\n    user_html += '</div>';\n\n    return user_html;\n};\n\n/**\n * Display the loading screen\n */\nESCOUnenrolment.prototype.startLoading = () => {\n    this.modal.getBody().find(\"#loading\").show();\n};\n\n/**\n * Show the loading screen\n */\nESCOUnenrolment.prototype.stopLoading = () => {\n    this.modal.getBody().find(\"#loading\").hide();\n};\n\n/**\n * Enrol the given itemid\n */\nESCOUnenrolment.prototype.unenrol = (itemid) => {\n    const context = this;\n    const parameters = {\n        id: this.course_id,\n        sesskey: M.cfg.sesskey,\n        action: 'enrolcohort',\n        enrolid: this.instance.id,\n    };\n\n    if (this.modal.getBody().find(SELECTORS.FIELD_ENTITY + ':checked').val() === \"cohorts\") {\n        parameters[\"cohortid\"] = itemid;\n        parameters[\"action\"] = 'unenrolcohort';\n    }else{\n        parameters[\"userid\"] = itemid;\n        parameters[\"action\"] = 'unenroluser';\n    }\n\n\n    $.ajax({\n        url: M.cfg.wwwroot + '/enrol/simplesco/ajax.php',\n        method: 'POST',\n        dataType: 'json',\n        data: build_querystring(parameters),\n        success: (result) => {\n            if (result.error) {\n                return Notification.exception(result);\n            }\n            context.require_refresh = true;\n            context.unenrol_count++;\n            context.modal.getBody().find(SELECTORS.AREA_RESULTS).find('div.item[rel=\"' + itemid + '\"]').addClass(\"enrolled\");\n        },\n        error: (resultat, statut, erreur) => {\n            Notification.exception(erreur);\n        },\n        beforeSend : () => {\n            context.startLoading();\n        }\n    }).always(() => {\n        context.stopLoading();\n    });\n};\n\n/**\n * Enrol the given itemid\n */\nESCOUnenrolment.prototype.unenrolall = () => {\n    const context = this;\n    let parameters = {\n        id: this.course_id,\n        sesskey: M.cfg.sesskey,\n        action: 'enrolcohort',\n        enrolid: this.instance.id,\n    };\n\n    if (this.modal.getBody().find(SELECTORS.FIELD_ENTITY + ':checked').val() === \"cohorts\") {\n        parameters[\"action\"] = 'unenrolallcohort';\n    }else{\n        parameters[\"action\"] = 'unenrolalluser';\n    }\n\n\n    $.ajax({\n        url: M.cfg.wwwroot + '/enrol/simplesco/ajax.php',\n        method: 'POST',\n        dataType: 'json',\n        data: build_querystring(parameters),\n        success: (result) => {\n            if (result.error) {\n                return Notification.exception(result);\n            }\n            context.require_refresh = true;\n            context.hide();\n        },\n        error: (resultat, statut, erreur) => {\n            Notification.exception(erreur);\n        },\n        beforeSend : () => {\n            context.startLoading();\n        }\n    }).always(() => {\n        context.stopLoading();\n    });\n};\n\nexport const init = config => {\n    (new ESCOUnenrolment(config));\n};"],"file":"unenrolment.min.js"}