{"version":3,"sources":["../src/unenrolment.js"],"names":["SELECTORS","BUTTON_TRIGGER","BUTTON_LOADMORE","BUTTON_UNENROL","BUTTON_UNENROL_ALL","FIELD_ENTITY","AREA_RESULTS","ESCOUnenrolment","options","course_id","instance","init","Promise","all","component","key","ModalFactory","create","type","types","DEFAULT","large","then","values","strings","modal","setTitle","body","setBody","setFooter","getRoot","on","ModalEvents","hidden","require_refresh","location","reload","bindEvents","search","catch","Notification","exception","document","addEventListener","event","target","closest","preventDefault","show","getBody","find","getFooter","confirm","unenrolall","itemid","attr","unenrol","append","page","action","val","parameters","id","sesskey","M","cfg","perpage","enrolcount","enrol_count","enrolid","remove","$","ajax","url","wwwroot","method","dataType","data","build_querystring","success","result","error","string_total_item","replace","response","totalusers","totalcohorts","html","line","cohorts","cohort","renderCohort","users","user","renderUser","count","length","resultat","statut","erreur","beforeSend","startLoading","always","stopLoading","cohort_html","name","user_html","picture","fullname","extrafields","hide","unenrol_count","addClass","config"],"mappings":"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","sourcesContent":["'use strict';\n/**\n * ESCO Enrolment AMD module.\n *\n * @module     enrol_simplesco/unenrolment\n * @package    enrol_simplesco\n * @copyright  2016 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport {get_strings} from 'core/str';\nimport Notification from 'core/notification';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\n\nconst SELECTORS = {\n    BUTTON_TRIGGER: \".enrolusersbutton.enrol_simplesco_plugin.unenrol [type='submit']\",\n    BUTTON_LOADMORE: 'button[data-toggle=\"load-more\"]',\n    BUTTON_UNENROL: 'button[data-toggle=\"unenrol\"]',\n    BUTTON_UNENROL_ALL: 'button[data-toggle=\"unenrol-all\"]',\n    FIELD_ENTITY: 'input[name=\"entity\"]',\n    AREA_RESULTS: \"div#results\",\n};\n\nclass ESCOUnenrolment {\n    /** @var {array} */\n    strings = null;\n    /** @var {Modal} modal - */\n    modal = null;\n    /** @var {number} page - */\n    page = 0;\n    /** @var {number} perpage - */\n    perpage = 25;\n    /** @var {number} course_id - */\n    course_id = 0;\n    /** @var {boolean} unenrol_count - */\n    unenrol_count = 0;\n    /** @var {array} instance - */\n    instance = [];\n    /** @var {boolean} require_refresh - */\n    require_refresh = false;\n\n    constructor(options) {\n        this.course_id = options.course_id;\n        this.instance = options.instance;\n        this.init();\n    }\n\n    init() {\n        Promise.all([\n            get_strings([\n                {component: 'enrol_simplesco', key: 'unenroltitle'}, //0\n                {component: 'enrol_simplesco', key: 'btnunenrolall'},\n                {component: 'enrol_simplesco', key: 'btnclose'},\n                {component: 'enrol_simplesco', key: 'browseusers'},\n                {component: 'enrol_simplesco', key: 'browsecohorts'},\n                {component: 'enrol', key: 'ajaxxusersfound'},\n                {component: 'enrol_simplesco', key: 'ajaxxcohortfound'},\n                {component: 'enrol', key: 'ajaxnext25'},\n                {component: 'enrol_simplesco', key: 'unenrolusers'},\n            ]),\n            ModalFactory.create({\n                type: ModalFactory.types.DEFAULT,\n                large: true,\n            }, undefined)])\n        .then(values => {\n            this.strings = values[0];\n            this.modal = values[1];\n\n            this.modal.setTitle(this.strings[0]);\n\n            const body = `<div class=\"form-inline mform simplesco\">\n            <div class=\"search-control\">\n            <div class=\"entity-selector\">\n            <label><input type=\"radio\" name=\"entity\" value=\"users\" checked=\"checked\"/>${this.strings[3]}</label>\n            <label><input type=\"radio\" name=\"entity\" value=\"cohorts\"/>${this.strings[4]}</label>\n            </div>\n            </div>\n            <div id=\"results\"></div>\n            <div id=\"loading\" style=\"display:none;\">CHARGEMENT</div>\n            </div>`;\n\n            this.modal.setBody(body);\n\n            this.modal.setFooter(`<button class=\"btn btn-primary\" data-toggle=\"unenrol-all\">${this.strings[1]}</button>\n            <button class=\"btn btn-primary\" data-action=\"hide\">${this.strings[2]}</button>`);\n\n            this.modal.getRoot().on(ModalEvents.hidden, () => {\n                if (this.require_refresh) {\n                    location.reload();\n                }\n            });\n\n            this.bindEvents();\n            this.search();\n        })\n        .catch(Notification.exception);\n    }\n\n    /**\n     * Bind events needed for the modal to work\n     */\n    bindEvents() {\n        document.addEventListener('click', event => {\n            if (event.target.closest(SELECTORS.BUTTON_TRIGGER)) {\n                event.preventDefault();\n                this.modal.show();\n                return;\n            }\n        });\n\n        this.modal.getBody().find(SELECTORS.FIELD_ENTITY).on(\"change\", (/*event*/) => {\n            this.search();\n        });\n\n        this.modal.getBody().on(\"click\", SELECTORS.BUTTON_LOADMORE, (event) => {\n            event.preventDefault();\n            this.search(true);\n            return false;\n        });\n\n        this.modal.getFooter().on(\"click\", SELECTORS.BUTTON_UNENROL_ALL, (event) => {\n            event.preventDefault();\n            if (confirm('Vous allez désinscrire tous les utilisateurs de ce cours ! Voulez-vous continuer ?')) {\n                this.unenrolall();\n            }\n            return false;\n        });\n\n        this.modal.getBody().find(SELECTORS.AREA_RESULTS).on(\"click\", SELECTORS.BUTTON_UNENROL,(event) => {\n            event.preventDefault();\n            const itemid = $(event.target).attr(\"value\");\n            this.unenrol(itemid);\n            return false;\n        });\n    }\n\n    /**\n     * Send the send request to server(s) and then process the results\n     */\n    search(append) {\n        if (append) {\n            this.page++;\n        } else {\n            this.page = 0;\n        }\n\n        let action = \"searchusersenrol\";\n        if (this.modal.getBody().find(SELECTORS.FIELD_ENTITY + ':checked').val() === \"cohorts\") {\n            action = \"searchcohortsenrol\";\n        }\n\n        const parameters = {\n            id: this.course_id,\n            sesskey: M.cfg.sesskey,\n            action: action,\n            page: this.page,\n            perpage: this.perpage,\n            enrolcount: this.enrol_count,\n            enrolid: this.instance.id,\n        };\n\n        this.modal.getBody().find(SELECTORS.AREA_RESULTS).find('button[data-toggle=\"load-more\"]').remove();\n        $.ajax({\n            url: M.cfg.wwwroot + '/enrol/simplesco/ajax.php',\n            method: 'POST',\n            dataType: 'json',\n            // eslint-disable-next-line no-unused-vars\n            data: build_querystring(parameters),\n            success: (result) => {\n                if (result.error) {\n                    return Notification.exception(result);\n                }\n                let string_total_item = this.strings[5].replace(\"{$a}\", result.response.totalusers);\n                if (action === \"searchcohortsenrol\") {\n                    string_total_item = this.strings[6].replace(\"{$a}\", result.response.totalcohorts);\n                }\n\n                if (!append) {\n                    this.modal.getBody().find(SELECTORS.AREA_RESULTS).html(\"\");\n                    this.modal.getBody().find(SELECTORS.AREA_RESULTS).append(`<div class=\"total_results\">${string_total_item}\n                        </div>`);\n                }\n                if (action === \"searchcohortsenrol\") {\n                    for (let line in result.response.cohorts) {\n                        const cohort = result.response.cohorts[line];\n                        this.modal.getBody().find(SELECTORS.AREA_RESULTS).append(this.renderCohort(cohort));\n                    }\n                } else {\n                    for (let line in result.response.users) {\n                        const user = result.response.users[line];\n                        this.modal.getBody().find(SELECTORS.AREA_RESULTS).append(this.renderUser(user));\n                    }\n                }\n                const count = this.modal.getBody().find(SELECTORS.AREA_RESULTS).find(\".item\").length;\n                if (count < result.response.totalusers) {\n                    this.modal.getBody().find(SELECTORS.AREA_RESULTS)\n                        .append(`<div class=\"text-center\"><button class=\"btn btn-secondary\" data-toggle=\"load-more\">'\n                            ${this.strings[7]}</button></div>`);\n                }\n            },\n            error: (resultat, statut, erreur) => {\n                Notification.exception(erreur);\n            },\n            beforeSend: () => {\n                this.startLoading();\n            }\n        }).always(() => {\n            this.stopLoading();\n        });\n    }\n\n    /**\n     * Render user data to HTML format\n     * @param cohort\n     */\n    renderCohort(cohort) {\n        const count = this.modal.getBody().find(SELECTORS.AREA_RESULTS).find(\".cohort\").length;\n        const cohort_html = `<div class=\"cohort item clearfix\" rel=\"${cohort.id}\">\n        <div class=\"count\">${count + 1}</div>\n        <div class=\"details\">\n        <div class=\"fullname\">${cohort.name}</div>\n        </div>\n        <div class=\"options\">\n        <button class=\"btn btn-success\" data-toggle=\"unenrol\" value=\"${cohort.id}\">\n            ${this.strings[8]}</button>\n        </div>\n        </div>`;\n\n        return cohort_html;\n    }\n\n    /**\n     * Render user data to HTML format\n     * @param user\n     */\n    renderUser(user) {\n        const count = this.modal.getBody().find(SELECTORS.AREA_RESULTS).find(\".user\").length;\n        const user_html = `<div class=\"user item clearfix\" rel=\"${user.id}\">\n        <div class=\"count\">${count + 1}</div>\n        <div class=\"picture\">${user.picture}</div>\n        <div class=\"details\">\n        <div class=\"fullname\">${user.fullname}</div>\n        <div class=\"extrafields\">${user.extrafields}</div>\n        </div>\n        <div class=\"options\">\n        <button class=\"btn btn-success\" data-toggle=\"unenrol\" value=\"${user.id}\">${this.strings[8]}</button>\n        </div>\n        </div>`;\n\n        return user_html;\n    }\n\n    /**\n     * Display the loading screen\n     */\n    startLoading() {\n        this.modal.getBody().find(\"#loading\").show();\n    }\n\n    /**\n     * Show the loading screen\n     */\n    stopLoading() {\n        this.modal.getBody().find(\"#loading\").hide();\n    }\n\n    /**\n     * Enrol the given itemid\n     */\n    unenrol(itemid) {\n        const parameters = {\n            id: this.course_id,\n            sesskey: M.cfg.sesskey,\n            action: 'enrolcohort',\n            enrolid: this.instance.id,\n        };\n\n        if (this.modal.getBody().find(SELECTORS.FIELD_ENTITY + ':checked').val() === \"cohorts\") {\n            parameters[\"cohortid\"] = itemid;\n            parameters[\"action\"] = 'unenrolcohort';\n        }else{\n            parameters[\"userid\"] = itemid;\n            parameters[\"action\"] = 'unenroluser';\n        }\n\n        $.ajax({\n            url: M.cfg.wwwroot + '/enrol/simplesco/ajax.php',\n            method: 'POST',\n            dataType: 'json',\n            // eslint-disable-next-line no-unused-vars\n            data: build_querystring(parameters),\n            success: (result) => {\n                if (result.error) {\n                    return Notification.exception(result);\n                }\n                this.require_refresh = true;\n                this.unenrol_count++;\n                this.modal.getBody().find(SELECTORS.AREA_RESULTS).find(`div.item[rel=\"${itemid}\"]`).addClass(\"enrolled\");\n            },\n            error: (resultat, statut, erreur) => {\n                Notification.exception(erreur);\n            },\n            beforeSend : () => {\n                this.startLoading();\n            }\n        }).always(() => {\n            this.stopLoading();\n        });\n    }\n\n    /**\n     * Enrol the given itemid\n     */\n    unenrolall() {\n        let parameters = {\n            id: this.course_id,\n            sesskey: M.cfg.sesskey,\n            action: 'enrolcohort',\n            enrolid: this.instance.id,\n        };\n\n        if (this.modal.getBody().find(SELECTORS.FIELD_ENTITY + ':checked').val() === \"cohorts\") {\n            parameters[\"action\"] = 'unenrolallcohort';\n        }else{\n            parameters[\"action\"] = 'unenrolalluser';\n        }\n\n        $.ajax({\n            url: M.cfg.wwwroot + '/enrol/simplesco/ajax.php',\n            method: 'POST',\n            dataType: 'json',\n            // eslint-disable-next-line no-unused-vars\n            data: build_querystring(parameters),\n            success: (result) => {\n                if (result.error) {\n                    return Notification.exception(result);\n                }\n                this.require_refresh = true;\n                //this.hide();\n            },\n            error: (resultat, statut, erreur) => {\n                Notification.exception(erreur);\n            },\n            beforeSend : () => {\n                this.startLoading();\n            }\n        }).always(() => {\n            this.stopLoading();\n        });\n    }\n}\n\nexport const init = config => {\n    (new ESCOUnenrolment(config));\n};"],"file":"unenrolment.min.js"}