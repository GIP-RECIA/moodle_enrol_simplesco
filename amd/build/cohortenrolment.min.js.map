{"version":3,"sources":["../src/cohortenrolment.js"],"names":["SELECTORS","BUTTON_TRIGGER","BUTTON_COLLAPSE","BUTTON_LOADMORE","BUTTON_ENROL","BUTTON_SEARCH","FIELD_TYPE","FIELD_ROLES","FIELD_DURATION","FIELD_SEARCH","FIELD_STARTDATE","FIELD_COHORT_GROUP","AREA_RESULTS","ESCOCohortEnrolment","options","course_id","instance","start_dates","role_default","init","prototype","modal","page","perpage","enrol_count","assignales_roles","groups","require_refresh","triggerButtons","$","when","Str","get_strings","component","key","ModalFactory","create","type","types","DEFAULT","large","then","strings","setTitle","body","setBody","setFooter","getRoot","on","ModalEvents","hidden","location","reload","bindEvents","populateRoles","updateStartDateList","updateDurationsList","bind","fail","Notification","exception","show","getBody","find","trigger","event","preventDefault","closest","toggleClass","search","which","cohortid","attr","enrol","parameters","id","sesskey","M","cfg","action","enrolid","groupeid","val","role","startdate","duration","recovergrades","ajax","url","wwwroot","method","dataType","data","build_querystring","success","result","error","addClass","resultat","statut","erreur","beforeSend","startLoading","always","stopLoading","length","updateRolesList","response","renderCohort","cohort","count","cohort_html","name","append","enrolcount","remove","html","replace","totalcohorts","group","line","cohorts","hide","select","i","selected","get_string","text","config"],"mappings":"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","sourcesContent":["/**\n * ESCO Enrolment AMD module.\n *\n * @module     enrol_manual/quickenrolment\n * @copyright  2016 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport Str from 'core/str';\nimport Notification from 'core/notification';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\n\nconst SELECTORS = {\n    BUTTON_TRIGGER: \"button#enrol_simplesco_addcohort\",\n    BUTTON_COLLAPSE: '.collapsible .ftoggler a',\n    BUTTON_LOADMORE: 'button[data-toggle=\"load-more\"]',\n    BUTTON_ENROL: 'button[data-toggle=\"enrol\"]',\n    BUTTON_SEARCH: 'button#search',\n    FIELD_TYPE: 'input[name=\"enrol_simplesco_typesearch\"]',\n    FIELD_ROLES: 'select#enrol_simplesco_assignable_roles',\n    FIELD_DURATION: 'select#enrol_simplesco_assignable_duration',\n    FIELD_SEARCH: 'input#enrolusersearch',\n    FIELD_STARTDATE: 'select#enrol_simplesco_assignable_startdate',\n    FIELD_COHORT_GROUP: 'select[name=\"cohort_group\"]',\n    AREA_RESULTS: \"div#results\",\n};\n\nconst ESCOCohortEnrolment = (options) => {\n    this.course_id = options.course_id;\n    this.instance = options.instance;\n    this.start_dates = options.start_dates;\n    this.role_default = options.role_default;\n    this.init();\n};\n\n/** @var {Modal} modal */\nESCOCohortEnrolment.prototype.modal = null;\n/** @var {number} page - */\nESCOCohortEnrolment.prototype.page = 0;\n/** @var {number} perpage - */\nESCOCohortEnrolment.prototype.perpage = 25;\n/** @var {number} courseid - */\nESCOCohortEnrolment.prototype.course_id = 0;\n/** @var {number} courseid - */\nESCOCohortEnrolment.prototype.role_default = 0;\n/** @var {boolean} enrol_count - */\nESCOCohortEnrolment.prototype.enrol_count = 0;\n/** @var {array} assignales_roles - */\nESCOCohortEnrolment.prototype.assignales_roles = [];\n/** @var {array} instance - */\nESCOCohortEnrolment.prototype.instance = [];\n/** @var {array} start_dates - */\nESCOCohortEnrolment.prototype.start_dates = [];\n/** @var {array} groups - */\nESCOCohortEnrolment.prototype.groups = [];\n/** @var {boolean} require_refresh - */\nESCOCohortEnrolment.prototype.require_refresh = false;\n\nESCOCohortEnrolment.prototype.init = () => {\n    const context = this;\n    const triggerButtons = $(SELECTORS.BUTTON_TRIGGER);\n\n    $.when(\n        Str.get_strings([\n            {component: 'enrol_simplesco', key: 'enrolcohorttitle'}, // 0\n            {component: 'enrol_simplesco', key: 'btnclosecohort'},\n            {component: 'role', key: 'assignroles'},\n            {component: 'enrol', key: 'none'},\n            {component: 'enrol', key: 'enrolmentoptions'},\n            {component: 'moodle', key: 'startingfrom'},\n            {component: 'enrol', key: 'enrolperiod'},\n            {component: 'enrol', key: 'unlimitedduration'},\n            {component: 'enrol_simplesco', key: 'searchoption'},\n            {component: 'enrol', key: 'usersearch'},\n            {component: 'enrol_simplesco', key: 'noresultliste'}, // 10\n            {component: 'enrol_simplesco', key: 'allresultliste'},\n            {component: 'enrol_simplesco', key: 'ajaxxcohortfound'},\n            {component: 'enrol', key: 'ajaxnext25'},\n            {component: 'enrol', key: 'enrol'},\n            {component: 'enrol_simplesco', key: 'cohort'},\n            {component: 'enrol_cohort', key: 'addgroup'},\n        ]),\n        ModalFactory.create({\n            type: ModalFactory.types.DEFAULT,\n            large: true,\n        }, triggerButtons)\n    ).then(function (strings, modal) {\n        this.strings = strings;\n        this.modal = modal;\n\n        modal.setTitle(strings[0]);\n\n\n        let body = '<div class=\"form-inline mform simplesco\">';\n\n        body += '<div class=\"form-group\">';\n        body += '<label for=\"enrol_simplesco_assignable_roles\">' + strings[2] + ' : </label>';\n        body += '<select id=\"enrol_simplesco_assignable_roles\"><option value=\"\">' + strings[3] + '</option></select>';\n        body += '</div>';\n\n        body += '<fieldset class=\"collapsible collapsed\" id=\"enrolment_options\">';\n        body += '<legend class=\"ftoggler\"><a href=\"#\" class=\"fheader\" role=\"button\" aria-controls=\"enrolment_options\" '\n            + 'aria-expanded=\"false\">' + strings[4] + '</a></legend>';\n        body += '<div class=\"fcontainer\">';\n        body += '<div class=\"startdate form-group\"><label for=\"enrol_simplesco_assignable_startdate\">' + strings[5] + ':</label> '\n            + '<select id=\"enrol_simplesco_assignable_startdate\"></select></div>';\n        body += '<div class=\"duration form-group\"><label for=\"enrol_simplesco_assignable_duration\">' + strings[6] + ' :</label> '\n            + '<select id=\"enrol_simplesco_assignable_duration\"><option value=\"0\" selected=\"selected\">' + strings[7]\n            + '</option></select></div>';\n        body += '</div>';\n        body += '</fieldset>';\n\n        body += '<fieldset class=\"collapsible collapsed\" id=\"enrolment_searchs\">';\n        body += '<legend class=\"ftoggler\"><a href=\"#\" class=\"fheader\" role=\"button\" aria-controls=\"enrolment_options\" '\n            + 'aria-expanded=\"false\">' + strings[8] + '</a></legend>';\n        body += '<div class=\"fcontainer\">';\n        body += '<label for=\"enrolusersearch\">' + strings[9] + ' :</label> <input type=\"text\" id=\"enrolusersearch\" value=\"\" '\n            + 'class=\"form-control\"/>';\n        body += '<div class=\"text-center\"><button class=\"btn btn-primary\" id=\"search\"> ' + strings[9] + '</button></div>';\n        body += '</div>';\n        body += '</fieldset>';\n\n        body += '<div id=\"results\"></div>';\n\n        body += '<div id=\"loading\" style=\"display:none;\">CHARGEMENT</div>';\n\n        body += '</div>';\n        modal.setBody(body);\n\n        modal.setFooter('<button class=\"btn btn-primary\" data-action=\"hide\">' + strings[1] + '</button>');\n\n        modal.getRoot().on(ModalEvents.hidden, () => {\n            if (context.require_refresh) {\n                location.reload();\n            }\n        });\n\n        this.bindEvents();\n        this.populateRoles();\n        this.updateStartDateList();\n        this.updateDurationsList();\n    }.bind(this)).fail(Notification.exception);\n};\n\n/**\n * Bind events needed for the modal to work\n */\nESCOCohortEnrolment.prototype.bindEvents = () => {\n    const context = this;\n    $(\"body\").on(\"click\", SELECTORS.BUTTON_TRIGGER, () => {\n        context.modal.show();\n        context.modal.getBody().find(SELECTORS.BUTTON_SEARCH).trigger(\"click\");\n    });\n    this.modal.getBody().find(SELECTORS.BUTTON_COLLAPSE).on(\"click\", (event) => {\n        event.preventDefault();\n        $(this).closest(\".collapsible\").toggleClass(\"collapsed\");\n        return false;\n    });\n    this.modal.getBody().find(SELECTORS.BUTTON_SEARCH).on(\"click\", (event) => {\n        event.preventDefault();\n        context.search();\n        return false;\n    });\n    this.modal.getBody().find(SELECTORS.FIELD_SEARCH).on(\"keypress\", (event) => {\n        if (event.which === 13) {\n            event.preventDefault();\n            context.search();\n            return false;\n        }\n    });\n    this.modal.getBody().on(\"click\", SELECTORS.BUTTON_LOADMORE, (event) => {\n        event.preventDefault();\n        context.search(true);\n        return false;\n    });\n    this.modal.getBody().on(\"click\", SELECTORS.BUTTON_ENROL, (event) => {\n        event.preventDefault();\n        const cohortid = $(this).attr(\"value\");\n        context.enrol(cohortid);\n        return false;\n    });\n};\n\n/**\n * Enrol the given userid\n */\nESCOCohortEnrolment.prototype.enrol = (cohortid) => {\n    const context = this;\n    const parameters = {\n        id: this.course_id,\n        sesskey: M.cfg.sesskey,\n        action: 'enrolcohort',\n        enrolid: this.instance.id,\n        cohortid : cohortid,\n        groupeid : this.modal.getBody().find(SELECTORS.FIELD_COHORT_GROUP + '[rel=\"'+cohortid+'\"]').val(),\n        role : this.modal.getBody().find(SELECTORS.FIELD_ROLES).val(),\n        startdate : this.modal.getBody().find(SELECTORS.FIELD_STARTDATE).val(),\n        duration : this.modal.getBody().find(SELECTORS.FIELD_DURATION).val(),\n        recovergrades : 0,\n    };\n    $.ajax({\n        url: M.cfg.wwwroot + '/enrol/simplesco/ajax.php',\n        method: 'POST',\n        dataType: 'json',\n        data: build_querystring(parameters),\n        success: (result, statut) => {\n            if (result.error) {\n                return Notification.exception(result);\n            }\n            context.require_refresh = true;\n            context.enrol_count++;\n            context.modal.getBody().find(SELECTORS.AREA_RESULTS).find('div.cohort[rel=\"' + cohortid + '\"]').addClass(\"enrolled\");\n        },\n        error: (resultat, statut, erreur) => {\n            Notification.exception(erreur);\n        },\n        beforeSend : () => {\n            context.startLoading();\n        }\n    }).always(() => {\n        context.stopLoading();\n    });\n};\n\n/**\n * Load the list of roles from the database for given course\n */\nESCOCohortEnrolment.prototype.populateRoles = () => {\n    if (this.assignales_roles.length > 0) {\n        return this.updateRolesList();\n    }\n    const context = this;\n    $.ajax({\n        url: M.cfg.wwwroot + '/enrol/ajax.php',\n        method: 'POST',\n        dataType: 'json',\n        data: 'id=' + this.course_id + '&action=getassignable&sesskey=' + M.cfg.sesskey,\n        success: (result, statut) => {\n            if (result.error) {\n                return Notification.exception(result);\n            }\n            context.assignales_roles = result.response;\n            context.updateRolesList();\n        },\n        error: (resultat, statut, erreur) => {\n            Notification.exception(erreur);\n        },\n        beforeSend: () => {\n            context.startLoading();\n        }\n    }).always(() => {\n        context.stopLoading();\n    });\n};\n\n/**\n * Generate HTML for cohort display\n */\nESCOCohortEnrolment.prototype.renderCohort = (cohort) => {\n    const count = this.modal.getBody().find(SELECTORS.AREA_RESULTS).find(\".cohort\").length;\n    let cohort_html = '<div class=\"cohort item clearfix\" rel=\"' + cohort.id + '\">';\n\n    cohort_html += '<div class=\"count\">' + (count) + '</div>';\n\n    cohort_html += '<div class=\"details\">';\n    cohort_html += '<div class=\"fullname\">' + cohort.name + '</div>';\n    cohort_html += '</div>';\n\n    cohort_html += '<div class=\"options\">';\n    cohort_html += '<select name=\"cohort_group\" rel=\"' + cohort.id + '\">';\n\n    for (let id in this.groups) {\n        cohort_html += '<option value=\"' + id + '\">' + this.groups[id] + '</option>';\n    }\n\n    cohort_html += '</select>';\n    cohort_html += '<button class=\"btn btn-success\" data-toggle=\"enrol\" value=\"' + cohort.id + '\">'\n        + this.strings[14] + '</button>';\n    cohort_html += '</div>';\n\n    cohort_html += '</div>';\n\n    return cohort_html;\n};\n\n/**\n * Send the send request to server(s) and then process the results\n */\nESCOCohortEnrolment.prototype.search = (append) => {\n    const context = this;\n\n    if (append) {\n        this.page++;\n    } else {\n        this.page = 0;\n    }\n    const parameters = {\n        id: this.course_id,\n        sesskey: M.cfg.sesskey,\n        action: 'searchcohorts',\n        search: this.modal.getBody().find(SELECTORS.FIELD_SEARCH).val(),\n        page: this.page,\n        perpage: this.perpage,\n        enrolcount: this.enrol_count,\n        enrolid: this.instance.id,\n    };\n    context.modal.getBody().find(SELECTORS.AREA_RESULTS).find('button[data-toggle=\"load-more\"]').remove();\n    $.ajax({\n        url: M.cfg.wwwroot + '/enrol/simplesco/ajax.php',\n        method: 'POST',\n        dataType: 'json',\n        data: build_querystring(parameters),\n        success: (result, statut) => {\n            if (result.error) {\n                return Notification.exception(result);\n            }\n            if (!append) {\n                context.modal.getBody().find(SELECTORS.AREA_RESULTS).html(\"\");\n                context.modal.getBody().find(SELECTORS.AREA_RESULTS)\n                    .append('<div class=\"total_results\">' + context.strings[12].replace(\"{$a}\",\n                        result.response.totalcohorts) + '</div>');\n                context.modal.getBody().find(SELECTORS.AREA_RESULTS)\n                    .append('<div class=\"item cohort clearfix\"><div class=\"count\">NÂ°</div><div class=\"details\">'\n                        + context.strings[14] + '</div><div class=\"options\">' + context.strings[15] + '</div></div>');\n            }\n            context.groups = result.response.group;\n            for (let line in result.response.cohorts) {\n                const cohort = result.response.cohorts[line];\n                context.modal.getBody().find(SELECTORS.AREA_RESULTS).append(context.renderCohort(cohort));\n            }\n            const count = (context.modal.getBody().find(SELECTORS.AREA_RESULTS).find(\".item\").length - 1);\n            if (count < result.response.totalcohorts) {\n                context.modal.getBody().find(SELECTORS.AREA_RESULTS)\n                    .append('<div class=\"text-center\"><button class=\"btn btn-secondary\" data-toggle=\"load-more\">'\n                        + context.strings[13] + '</button></div>');\n            }\n        },\n        error: (resultat, statut, erreur) => {\n            Notification.exception(erreur);\n        },\n        beforeSend: () => {\n            context.startLoading();\n        }\n    }).always(() => {\n        context.stopLoading();\n    });\n};\n/**\n * Display the loading screen\n */\nESCOCohortEnrolment.prototype.startLoading = () => {\n    this.modal.getBody().find(\"#loading\").show();\n};\n/**\n * Show the loading screen\n */\nESCOCohortEnrolment.prototype.stopLoading = () => {\n    this.modal.getBody().find(\"#loading\").hide();\n};\n/**\n * Update the roles select field\n */\nESCOCohortEnrolment.prototype.updateRolesList = () => {\n    const select = this.modal.getBody().find(SELECTORS.FIELD_ROLES);\n    for (let i in this.assignales_roles) {\n        const selected = (this.role_default == this.assignales_roles[i].id) ? 'selected=\"selected\"' : \"\";\n        $(select).append('<option value=\"' + this.assignales_roles[i].id + '\" '+ selected + '>' + this.assignales_roles[i].name\n            + '</option>');\n    }\n};\n\n/**\n * Update the durations select field\n */\nESCOCohortEnrolment.prototype.updateDurationsList = () => {\n    const select = this.modal.getBody().find(SELECTORS.FIELD_DURATION);\n\n    $.when(Str.get_string('durationdays', 'enrol', '{a}')).then((text) => {\n        for (let i = 1; i <= 365; i++) {\n            $(select).append('<option value=\"' + i + '\">' + text.replace('{a}', i) + '</option>');\n        }\n    });\n};\n\n/**\n * Update the start date select field\n */\nESCOCohortEnrolment.prototype.updateStartDateList = () => {\n    const select = this.modal.getBody().find(SELECTORS.FIELD_STARTDATE);\n\n    for (let i in this.start_dates) {\n        $(select).append('<option value=\"' + i + '\">' + this.start_dates[i] + '</option>');\n    }\n\n};\n\n\nexport const init = config => {\n    (new ESCOCohortEnrolment(config));\n};"],"file":"cohortenrolment.min.js"}