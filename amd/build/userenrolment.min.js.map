{"version":3,"sources":["../src/userenrolment.js"],"names":["SELECTORS","BUTTON_TRIGGER","BUTTON_COLLAPSE","BUTTON_LOADMORE","BUTTON_ENROL","BUTTON_SEARCH","FIELD_TYPE","FIELD_ROLES","FIELD_DURATION","FIELD_SEARCH","FIELD_STARTDATE","AREA_RESULTS","ESCOUserEnrolment","options","course_id","instance","start_dates","role_default","init","prototype","modal","page","perpage","enrol_count","assignales_roles","require_refresh","$","when","Str","get_strings","component","key","ModalFactory","create","type","types","DEFAULT","large","then","strings","setTitle","body","setBody","setFooter","getRoot","on","ModalEvents","hidden","location","reload","bindEvents","displayLists","populateRoles","updateStartDateList","updateDurationsList","bind","fail","Notification","exception","show","getBody","find","event","preventDefault","closest","toggleClass","refreshSearchLists","search","which","userid","attr","enrol","val","hide","parameters","id","sesskey","M","cfg","action","enrolid","role","startdate","duration","recovergrades","ajax","url","wwwroot","method","dataType","data","build_querystring","success","result","error","addClass","resultat","statut","erreur","beforeSend","startLoading","always","stopLoading","length","updateRolesList","response","listes","code1","option","numliste","context","i","id_liste","charAt","$liste","value","html","append","j","renderUser","user","count","user_html","picture","fullname","extrafields","indexOf","enrolcount","code2","code3","code4","code5","remove","replace","totalusers","line","users","select","selected","name","get_string","text","config"],"mappings":"uOAOA,OACA,OACA,OACA,OACA,O,8UAEMA,CAAAA,CAAS,CAAG,CACdC,cAAc,CAAE,gCADF,CAEdC,eAAe,CAAE,0BAFH,CAGdC,eAAe,CAAE,mCAHH,CAIdC,YAAY,CAAE,+BAJA,CAKdC,aAAa,CAAE,eALD,CAMdC,UAAU,CAAE,4CANE,CAOdC,WAAW,CAAE,yCAPC,CAQdC,cAAc,CAAE,4CARF,CASdC,YAAY,CAAE,uBATA,CAUdC,eAAe,CAAE,6CAVH,CAWdC,YAAY,CAAE,aAXA,C,CAcZC,CAAiB,CAAG,SAACC,CAAD,CAAa,CACnC,CAAI,CAACC,SAAL,CAAiBD,CAAO,CAACC,SAAzB,CACA,CAAI,CAACC,QAAL,CAAgBF,CAAO,CAACE,QAAxB,CACA,CAAI,CAACC,WAAL,CAAmBH,CAAO,CAACG,WAA3B,CACA,CAAI,CAACC,YAAL,CAAoBJ,CAAO,CAACI,YAA5B,CACA,CAAI,CAACC,IAAL,EACH,C,CAGDN,CAAiB,CAACO,SAAlB,CAA4BC,KAA5B,CAAoC,IAApC,CAEAR,CAAiB,CAACO,SAAlB,CAA4BE,IAA5B,CAAmC,CAAnC,CAEAT,CAAiB,CAACO,SAAlB,CAA4BG,OAA5B,CAAsC,EAAtC,CAEAV,CAAiB,CAACO,SAAlB,CAA4BL,SAA5B,CAAwC,CAAxC,CAEAF,CAAiB,CAACO,SAAlB,CAA4BF,YAA5B,CAA2C,CAA3C,CAEAL,CAAiB,CAACO,SAAlB,CAA4BI,WAA5B,CAA0C,CAA1C,CAEAX,CAAiB,CAACO,SAAlB,CAA4BK,gBAA5B,CAA+C,EAA/C,CAEAZ,CAAiB,CAACO,SAAlB,CAA4BJ,QAA5B,CAAuC,EAAvC,CAEAH,CAAiB,CAACO,SAAlB,CAA4BH,WAA5B,CAA0C,EAA1C,CAEAJ,CAAiB,CAACO,SAAlB,CAA4BM,eAA5B,IAGAb,CAAiB,CAACO,SAAlB,CAA4BC,KAA5B,CAAoC,IAApC,CAEAR,CAAiB,CAACO,SAAlB,CAA4BD,IAA5B,CAAmC,UAAM,CAErCQ,UAAEC,IAAF,CACIC,UAAIC,WAAJ,CAAgB,CACZ,CAACC,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,YAA1B,CADY,CAEZ,CAACD,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,sBAA1B,CAFY,CAGZ,CAACD,SAAS,CAAE,MAAZ,CAAoBC,GAAG,CAAE,aAAzB,CAHY,CAIZ,CAACD,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,MAA1B,CAJY,CAKZ,CAACD,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,kBAA1B,CALY,CAMZ,CAACD,SAAS,CAAE,QAAZ,CAAsBC,GAAG,CAAE,cAA3B,CANY,CAOZ,CAACD,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,aAA1B,CAPY,CAQZ,CAACD,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,mBAA1B,CARY,CASZ,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,cAApC,CATY,CAUZ,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,aAApC,CAVY,CAWZ,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,gBAApC,CAXY,CAYZ,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,QAApC,CAZY,CAaZ,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,YAApC,CAbY,CAcZ,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,YAApC,CAdY,CAeZ,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,YAApC,CAfY,CAgBZ,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,YAApC,CAhBY,CAiBZ,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,YAApC,CAjBY,CAkBZ,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,YAApC,CAlBY,CAmBZ,CAACD,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,YAA1B,CAnBY,CAoBZ,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,eAApC,CApBY,CAqBZ,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,gBAApC,CArBY,CAsBZ,CAACD,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,iBAA1B,CAtBY,CAuBZ,CAACD,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,YAA1B,CAvBY,CAwBZ,CAACD,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,OAA1B,CAxBY,CAAhB,CADJ,CA2BIC,UAAaC,MAAb,CAAoB,CAChBC,IAAI,CAAEF,UAAaG,KAAb,CAAmBC,OADT,CAEhBC,KAAK,GAFW,CAApB,QA3BJ,EA+BEC,IA/BF,CA+BO,SAAUC,CAAV,CAAmBnB,CAAnB,CAA0B,CAC7B,KAAKmB,OAAL,CAAeA,CAAf,CACA,KAAKnB,KAAL,CAAaA,CAAb,CAEAA,CAAK,CAACoB,QAAN,CAAeD,CAAO,CAAC,CAAD,CAAtB,EAGA,GAAIE,CAAAA,CAAI,CAAG,6CAAX,CAEAA,CAAI,EAAI,4BAAR,CACAA,CAAI,EAAI,mDAAmDF,CAAO,CAAC,CAAD,CAA1D,CAAgE,aAAxE,CACAE,CAAI,EAAI,sEAAoEF,CAAO,CAAC,CAAD,CAA3E,CAAiF,oBAAzF,CACAE,CAAI,EAAI,QAAR,CAEAA,CAAI,EAAI,qEAAR,CACAA,CAAI,EAAI,0IACyBF,CAAO,CAAC,CAAD,CADhC,CACsC,eAD9C,CAEAE,CAAI,EAAI,4BAAR,CACAA,CAAI,EAAI,2FAAyFF,CAAO,CAAC,CAAD,CAAhG,CACF,+EADN,CAEAE,CAAI,EAAI,yFAAuFF,CAAO,CAAC,CAAD,CAA9F,CACF,0GADE,CAEFA,CAAO,CAAC,CAAD,CAFL,CAEW,0BAFnB,CAGAE,CAAI,EAAI,QAAR,CACAA,CAAI,EAAI,aAAR,CAEAA,CAAI,EAAI,2DAAR,CACAA,CAAI,EAAI,0IACyBF,CAAO,CAAC,CAAD,CADhC,CACsC,eAD9C,CAEAE,CAAI,EAAI,4BAAR,CACAA,CAAI,EAAI,wKACuEF,CAAO,CAAC,CAAD,CAD9E,CACoF,gBAD5F,CAEAE,CAAI,EAAI,8IACkDF,CAAO,CAAC,EAAD,CADzD,CACgE,gBADxE,CAEAE,CAAI,EAAI,8IACkDF,CAAO,CAAC,EAAD,CADzD,CACgE,gBADxE,CAGAE,CAAI,EAAI,sCAAR,CACAA,CAAI,EAAI,mEAAiEF,CAAO,CAAC,EAAD,CAAxE,CACF,wHADN,CAEAE,CAAI,EAAI,mEAAiEF,CAAO,CAAC,EAAD,CAAxE,CACF,wHADN,CAEAE,CAAI,EAAI,mEAAiEF,CAAO,CAAC,EAAD,CAAxE,CACF,wHADN,CAEAE,CAAI,EAAI,mEAAiEF,CAAO,CAAC,EAAD,CAAxE,CACF,wHADN,CAEAE,CAAI,EAAI,mEAAiEF,CAAO,CAAC,EAAD,CAAxE,CACF,wHADN,CAEAE,CAAI,EAAI,QAAR,CACAA,CAAI,EAAI,+CAAR,CACAA,CAAI,EAAI,kCAAkCF,CAAO,CAAC,EAAD,CAAzC,qIAAR,CAGAE,CAAI,EAAI,QAAR,CACAA,CAAI,EAAI,+EAA2EF,CAAO,CAAC,EAAD,CAAlF,CAAyF,iBAAjG,CACAE,CAAI,EAAI,QAAR,CACAA,CAAI,EAAI,aAAR,CAEAA,CAAI,EAAI,4BAAR,CAEAA,CAAI,EAAI,8DAAR,CAEAA,CAAI,EAAI,QAAR,CACArB,CAAK,CAACsB,OAAN,CAAcD,CAAd,EAEArB,CAAK,CAACuB,SAAN,CAAgB,0DAAwDJ,CAAO,CAAC,CAAD,CAA/D,CAAqE,WAArF,EAEAnB,CAAK,CAACwB,OAAN,GAAgBC,EAAhB,CAAmBC,UAAYC,MAA/B,CAAuC,UAAM,CACzC,GAAG,SAAQtB,eAAX,CAA2B,CACvBuB,QAAQ,CAACC,MAAT,EACH,CACJ,CAJD,EAMA,KAAKC,UAAL,GACA,KAAKC,YAAL,GACA,KAAKC,aAAL,GACA,KAAKC,mBAAL,GACA,KAAKC,mBAAL,EACH,CA9EM,CA8ELC,IA9EK,CA8EA,CA9EA,CA/BP,EA6GcC,IA7Gd,CA6GmBC,UAAaC,SA7GhC,CA8GH,CAhHD,CAqHA9C,CAAiB,CAACO,SAAlB,CAA4B+B,UAA5B,CAAyC,UAAM,CAE3C,cAAE,MAAF,EAAUL,EAAV,CAAa,OAAb,CAAsB7C,CAAS,CAACC,cAAhC,CAAgD,UAAM,CAClD,SAAQmB,KAAR,CAAcuC,IAAd,EACH,CAFD,EAIA,CAAI,CAACvC,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B7D,CAAS,CAACM,UAApC,EAAgDuC,EAAhD,CAAmD,QAAnD,CAA6D,UAAM,CAC/D,SAAQM,YAAR,EACH,CAFD,EAIA,CAAI,CAAC/B,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B7D,CAAS,CAACE,eAApC,EAAqD2C,EAArD,CAAwD,OAAxD,CAAiE,SAACiB,CAAD,CAAW,CACxEA,CAAK,CAACC,cAAN,GACA,cAAE,CAAF,EAAQC,OAAR,CAAgB,cAAhB,EAAgCC,WAAhC,CAA4C,WAA5C,EACA,QACH,CAJD,EAMA,CAAI,CAAC7C,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDhB,EAArD,CAAwD,QAAxD,CAAkE,UAAM,CACpE,SAAQqB,kBAAR,CAA2B,CAA3B,CACH,CAFD,EAIA,CAAI,CAAC9C,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B7D,CAAS,CAACK,aAApC,EAAmDwC,EAAnD,CAAsD,OAAtD,CAA+D,SAACiB,CAAD,CAAW,CACtEA,CAAK,CAACC,cAAN,GACA,SAAQI,MAAR,GACA,QACH,CAJD,EAKA,CAAI,CAAC/C,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B7D,CAAS,CAACS,YAApC,EAAkDoC,EAAlD,CAAqD,UAArD,CAAiE,SAACiB,CAAD,CAAW,CACxE,GAAmB,EAAhB,GAAAA,CAAK,CAACM,KAAT,CAAsB,CAClBN,CAAK,CAACC,cAAN,GACA,SAAQI,MAAR,GACA,QACH,CACJ,CAND,EAQA,CAAI,CAAC/C,KAAL,CAAWwC,OAAX,GAAqBf,EAArB,CAAwB,OAAxB,CAAiC7C,CAAS,CAACG,eAA3C,CAA4D,SAAC2D,CAAD,CAAW,CACnEA,CAAK,CAACC,cAAN,GACA,SAAQI,MAAR,KACA,QACH,CAJD,EAKA,CAAI,CAAC/C,KAAL,CAAWwC,OAAX,GAAqBf,EAArB,CAAwB,OAAxB,CAAiC7C,CAAS,CAACI,YAA3C,CAAyD,SAAC0D,CAAD,CAAW,CAChEA,CAAK,CAACC,cAAN,GACA,GAAMM,CAAAA,CAAM,CAAG,cAAE,CAAF,EAAQC,IAAR,CAAa,OAAb,CAAf,CACA,SAAQC,KAAR,CAAcF,CAAd,EACA,QACH,CALD,CAMH,CA5CD,CAiDAzD,CAAiB,CAACO,SAAlB,CAA4BgC,YAA5B,CAA2C,UAAM,CAC7C,OAAQ,CAAI,CAAC/B,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B7D,CAAS,CAACM,UAAV,CAAuB,UAAjD,EAA6DkE,GAA7D,EAAR,EACI,IAAK,QAAL,CACI,CAAI,CAACpD,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDG,OAArD,CAA6D,aAA7D,EAA4EL,IAA5E,GACA,CAAI,CAACvC,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDG,OAArD,CAA6D,aAA7D,EAA4EL,IAA5E,GACA,CAAI,CAACvC,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDG,OAArD,CAA6D,aAA7D,EAA4EL,IAA5E,GACA,CAAI,CAACvC,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDG,OAArD,CAA6D,aAA7D,EAA4EL,IAA5E,GACA,CAAI,CAACvC,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDG,OAArD,CAA6D,aAA7D,EAA4ES,IAA5E,GACA,CAAI,CAACP,kBAAL,GACA,MACJ,IAAK,KAAL,CACI,CAAI,CAAC9C,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDG,OAArD,CAA6D,aAA7D,EAA4EL,IAA5E,GACA,CAAI,CAACvC,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDG,OAArD,CAA6D,aAA7D,EAA4EL,IAA5E,GACA,CAAI,CAACvC,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDG,OAArD,CAA6D,aAA7D,EAA4EL,IAA5E,GACA,CAAI,CAACvC,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDG,OAArD,CAA6D,aAA7D,EAA4EL,IAA5E,GACA,CAAI,CAACvC,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDG,OAArD,CAA6D,aAA7D,EAA4EL,IAA5E,GACA,CAAI,CAACO,kBAAL,GACA,MACJ,IAAK,KAAL,CACI,CAAI,CAAC9C,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDG,OAArD,CAA6D,aAA7D,EAA4ES,IAA5E,GACA,CAAI,CAACrD,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDG,OAArD,CAA6D,aAA7D,EAA4ES,IAA5E,GACA,CAAI,CAACrD,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDG,OAArD,CAA6D,aAA7D,EAA4ES,IAA5E,GACA,CAAI,CAACrD,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDG,OAArD,CAA6D,aAA7D,EAA4ES,IAA5E,GACA,CAAI,CAACrD,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDG,OAArD,CAA6D,aAA7D,EAA4ES,IAA5E,GACA,MAvBR,CAyBH,CA1BD,CA+BA7D,CAAiB,CAACO,SAAlB,CAA4BoD,KAA5B,CAAoC,SAACF,CAAD,CAAY,IAEtCK,CAAAA,CAAU,CAAG,CACfC,EAAE,CAAE,CAAI,CAAC7D,SADM,CAEf8D,OAAO,CAAEC,CAAC,CAACC,GAAF,CAAMF,OAFA,CAGfG,MAAM,CAAE,OAHO,CAIfC,OAAO,CAAE,CAAI,CAACjE,QAAL,CAAc4D,EAJR,CAKfN,MAAM,CAAGA,CALM,CAMfY,IAAI,CAAG,CAAI,CAAC7D,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B7D,CAAS,CAACO,WAApC,EAAiDiE,GAAjD,EANQ,CAOfU,SAAS,CAAG,CAAI,CAAC9D,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B7D,CAAS,CAACU,eAApC,EAAqD8D,GAArD,EAPG,CAQfW,QAAQ,CAAG,CAAI,CAAC/D,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B7D,CAAS,CAACQ,cAApC,EAAoDgE,GAApD,EARI,CASfY,aAAa,CAAG,CATD,CAFyB,CAa5C1D,UAAE2D,IAAF,CAAO,CACHC,GAAG,CAAET,CAAC,CAACC,GAAF,CAAMS,OAAN,CAAgB,2BADlB,CAEHC,MAAM,CAAE,MAFL,CAGHC,QAAQ,CAAE,MAHP,CAIHC,IAAI,CAAEC,iBAAiB,CAACjB,CAAD,CAJpB,CAKHkB,OAAO,CAAE,iBAACC,CAAD,CAAoB,CACzB,GAAIA,CAAM,CAACC,KAAX,CAAkB,CACd,MAAOrC,WAAaC,SAAb,CAAuBmC,CAAvB,CACV,CACD,SAAQpE,eAAR,IACA,SAAQF,WAAR,GACA,SAAQH,KAAR,CAAcwC,OAAd,GAAwBC,IAAxB,CAA6B7D,CAAS,CAACW,YAAvC,EAAqDkD,IAArD,CAA0D,kBAAmBQ,CAAnB,CAA4B,KAAtF,EAA4F0B,QAA5F,CAAqG,UAArG,CACH,CAZE,CAaHD,KAAK,CAAE,eAACE,CAAD,CAAWC,CAAX,CAAmBC,CAAnB,CAA8B,CACjCzC,UAAaC,SAAb,CAAuBwC,CAAvB,CACH,CAfE,CAgBHC,UAAU,CAAG,qBAAM,CACf,SAAQC,YAAR,EACH,CAlBE,CAAP,EAmBGC,MAnBH,CAmBU,UAAM,CACZ,SAAQC,WAAR,EACH,CArBD,CAsBH,CAnCD,CAwCA1F,CAAiB,CAACO,SAAlB,CAA4BiC,aAA5B,CAA4C,UAAM,CAC9C,GAAmC,CAA/B,CAAA,CAAI,CAAC5B,gBAAL,CAAsB+E,MAA1B,CAAsC,CAClC,MAAO,CAAA,CAAI,CAACC,eAAL,EACV,CAED9E,UAAE2D,IAAF,CAAO,CACHC,GAAG,CAAET,CAAC,CAACC,GAAF,CAAMS,OAAN,CAAgB,iBADlB,CAEHC,MAAM,CAAE,MAFL,CAGHC,QAAQ,CAAE,MAHP,CAIHC,IAAI,CAAE,MAAQ,CAAI,CAAC5E,SAAb,CAAyB,gCAAzB,CAA4D+D,CAAC,CAACC,GAAF,CAAMF,OAJrE,CAKHgB,OAAO,CAAE,iBAACC,CAAD,CAAoB,CACzB,GAAIA,CAAM,CAACC,KAAX,CAAkB,CACd,MAAOrC,WAAaC,SAAb,CAAuBmC,CAAvB,CACV,CACD,SAAQrE,gBAAR,CAA2BqE,CAAM,CAACY,QAAlC,CACA,SAAQD,eAAR,EACH,CAXE,CAYHV,KAAK,CAAE,eAACE,CAAD,CAAWC,CAAX,CAAmBC,CAAnB,CAA8B,CACjCzC,UAAaC,SAAb,CAAuBwC,CAAvB,CACH,CAdE,CAeHC,UAAU,CAAG,qBAAM,CACf,SAAQC,YAAR,EACH,CAjBE,CAAP,EAkBGC,MAlBH,CAkBU,UAAM,CACZ,SAAQC,WAAR,EACH,CApBD,CAqBH,CA1BD,CA+BA1F,CAAiB,CAACO,SAAlB,CAA4B+C,kBAA5B,CAAiD,SAACwC,CAAD,CAAY,CACzD,GAAIC,CAAAA,CAAK,CAAG,CAAI,CAACvF,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,+BAA1B,EAA2DW,GAA3D,EAAZ,CACA,GAAIkC,CAAM,QAAV,CAAyB,CACrBA,CAAM,CAAG,OACZ,CAFD,IAEO,IAAsB,QAAlB,IAAOA,CAAP,CAAJ,CAAgC,CACnCA,CAAM,CAAG,KACZ,CACD,GAAc,IAAV,GAAAC,CAAJ,CAAoB,CAChBA,CAAK,CAAG,EACX,CATwD,GAUnDjC,CAAAA,CAAU,CAAG,CACfC,EAAE,CAAE,CAAI,CAAC7D,SADM,CAEfiE,MAAM,CAAE,WAFO,CAGfH,OAAO,CAAEC,CAAC,CAACC,GAAF,CAAMF,OAHA,CAIf+B,KAAK,CAAEA,CAJQ,CAKfC,MAAM,CAAE,CAAI,CAACxF,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B7D,CAAS,CAACM,UAAV,CAAuB,UAAjD,EAA6DkE,GAA7D,EALO,CAMfqC,QAAQ,CAAEH,CANK,CAVsC,CAkBnDI,CAAO,CAAG,CAlByC,CAmBzDpF,UAAE2D,IAAF,CAAO,CACHC,GAAG,CAAET,CAAC,CAACC,GAAF,CAAMS,OAAN,CAAgB,2BADlB,CAEHC,MAAM,CAAE,MAFL,CAGHC,QAAQ,CAAE,MAHP,CAIHC,IAAI,CAAEC,iBAAiB,CAACjB,CAAD,CAJpB,CAKHkB,OAAO,CAAE,iBAACC,CAAD,CAAoB,CACzB,GAAIA,CAAM,CAACC,KAAX,CAAkB,CACd,MAAOrC,WAAaC,SAAb,CAAuBmC,CAAvB,CACV,CACD,IAAK,GAAIkB,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGrC,CAAU,CAACmC,QAAX,CAAoBN,MAAxC,CAAgDQ,CAAC,EAAjD,CAAqD,IAC3CC,CAAAA,CAAQ,CAAGtC,CAAU,CAACmC,QAAX,CAAoBI,MAApB,CAA2BF,CAA3B,CADgC,CAE3CG,CAAM,CAAGJ,CAAO,CAAC1F,KAAR,CAAcwC,OAAd,GAAwBC,IAAxB,CAA6B,yBAA2BmD,CAAxD,CAFkC,CAG3CG,CAAK,CAAGtB,CAAM,CAACY,QAAP,CAAgB,SAAWO,CAA3B,CAHmC,CAIjDE,CAAM,CAACE,IAAP,CAAY,EAAZ,EACA,GAAwC,CAApC,EAAAvB,CAAM,CAACY,QAAP,CAAgBO,CAAhB,EAA0BT,MAA9B,CAA2C,CACvCW,CAAM,CAACG,MAAP,CAAc,sBAAsBP,CAAO,CAACvE,OAAR,CAAgB,EAAhB,CAAtB,CAA4C,WAA1D,CACH,CAFD,IAEO,CACH,IAAK,GAAI+E,CAAAA,CAAT,GAAczB,CAAAA,CAAM,CAACY,QAAP,CAAgBO,CAAhB,CAAd,CAAyC,CACrCE,CAAM,CAACG,MAAP,CAAc,mBAAoBC,CAApB,CAAwB,KAAxB,CAA+BzB,CAAM,CAACY,QAAP,CAAgBO,CAAhB,EAA0BM,CAA1B,CAA/B,CAA8D,WAA5E,CACH,CACD,GAAgB,CAAZ,EAAAN,CAAJ,CAAmB,CACfE,CAAM,CAACG,MAAP,CAAc,sBAAsBP,CAAO,CAACvE,OAAR,CAAgB,EAAhB,CAAtB,CAA4C,WAA1D,CACH,CACJ,CACD2E,CAAM,CAAC1C,GAAP,CAAW2C,CAAX,CACH,CACJ,CA1BE,CA2BHrB,KAAK,CAAE,eAACE,CAAD,CAAWC,CAAX,CAAmBC,CAAnB,CAA8B,CACjCzC,UAAaC,SAAb,CAAuBwC,CAAvB,CACH,CA7BE,CA8BHC,UAAU,CAAG,qBAAM,CACfW,CAAO,CAACV,YAAR,EACH,CAhCE,CAAP,EAiCGC,MAjCH,CAiCU,UAAM,CACZS,CAAO,CAACR,WAAR,EACH,CAnCD,CAoCH,CAvDD,CA6DA1F,CAAiB,CAACO,SAAlB,CAA4BoG,UAA5B,CAAyC,SAACC,CAAD,CAAU,IACzCC,CAAAA,CAAK,CAAG,CAAI,CAACrG,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B7D,CAAS,CAACW,YAApC,EAAkDkD,IAAlD,CAAuD,OAAvD,EAAgE0C,MAD/B,CAE3CmB,CAAS,CAAG,2CAA0CF,CAAI,CAAC7C,EAA/C,CAAoD,KAFrB,CAI/C+C,CAAS,EAAI,yBAAyBD,CAAK,CAAG,CAAjC,EAAsC,QAAnD,CACAC,CAAS,EAAI,0BAA0BF,CAAI,CAACG,OAA/B,CAAyC,QAAtD,CAEAD,CAAS,EAAI,yBAAb,CACAA,CAAS,EAAI,2BAA2BF,CAAI,CAACI,QAAhC,CAA2C,QAAxD,CACAF,CAAS,EAAI,8BAA8BF,CAAI,CAACK,WAAnC,CAAiD,QAA9D,CACAH,CAAS,EAAI,QAAb,CAEAA,CAAS,EAAI,yBAAb,CACAA,CAAS,EAAI,mEAA+DF,CAAI,CAAC7C,EAApE,CAAuE,KAAvE,CAA8E,CAAI,CAACpC,OAAL,CAAa,EAAb,CAA9E,CAAiG,WAA9G,CACAmF,CAAS,EAAI,QAAb,CAEAA,CAAS,EAAI,QAAb,CAEA,MAAOA,CAAAA,CACV,CAnBD,CAuBA9G,CAAiB,CAACO,SAAlB,CAA4BgD,MAA5B,CAAqC,SAACkD,CAAD,CAAY,IAEzCnF,CAAAA,CAFyC,CAI7C,GAAGmF,CAAH,CAAU,CACN,CAAI,CAAChG,IAAL,EACH,CAFD,IAEK,CACD,CAAI,CAACA,IAAL,CAAY,CACf,CACD,GAAsG,CAAC,CAAnG,IAAC,QAAD,CAAW,KAAX,EAAkByG,OAAlB,CAA0B,CAAI,CAAC1G,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B7D,CAAS,CAACM,UAAV,CAAuB,UAAjD,EAA6DkE,GAA7D,EAA1B,CAAJ,CAA0G,CACtGtC,CAAI,CAAG,MACV,CACD,GAAMwC,CAAAA,CAAU,CAAG,CACfC,EAAE,CAAE,CAAI,CAAC7D,SADM,CAEf8D,OAAO,CAAEC,CAAC,CAACC,GAAF,CAAMF,OAFA,CAGfG,MAAM,CAAE,aAHO,CAIfZ,MAAM,CAAE,CAAI,CAAC/C,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B7D,CAAS,CAACS,YAApC,EAAkD+D,GAAlD,EAJO,CAKfoC,MAAM,CAAE,CAAI,CAACxF,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B7D,CAAS,CAACM,UAAV,CAAuB,UAAjD,EAA6DkE,GAA7D,EALO,CAMfqC,QAAQ,CAAE,OANK,CAOfxF,IAAI,CAAE,CAAI,CAACA,IAPI,CAQfC,OAAO,CAAE,CAAI,CAACA,OARC,CASfyG,UAAU,CAAE,CAAI,CAACxG,WATF,CAUfyD,OAAO,CAAE,CAAI,CAACjE,QAAL,CAAc4D,EAVR,CAWfzC,IAAI,CAAEA,CAXS,CAYfyE,KAAK,CAAE,CAAI,CAACvF,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDW,GAArD,EAZQ,CAafwD,KAAK,CAAE,CAAI,CAAC5G,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDW,GAArD,EAbQ,CAcfyD,KAAK,CAAE,CAAI,CAAC7G,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDW,GAArD,EAdQ,CAef0D,KAAK,CAAE,CAAI,CAAC9G,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDW,GAArD,EAfQ,CAgBf2D,KAAK,CAAE,CAAI,CAAC/G,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDW,GAArD,EAhBQ,CAAnB,CAkBA,SAAQpD,KAAR,CAAcwC,OAAd,GAAwBC,IAAxB,CAA6B7D,CAAS,CAACW,YAAvC,EAAqDkD,IAArD,CAA0D,mCAA1D,EAA6FuE,MAA7F,GACA1G,UAAE2D,IAAF,CAAO,CACHC,GAAG,CAAET,CAAC,CAACC,GAAF,CAAMS,OAAN,CAAgB,2BADlB,CAEHC,MAAM,CAAE,MAFL,CAGHC,QAAQ,CAAE,MAHP,CAIHC,IAAI,CAAEC,iBAAiB,CAACjB,CAAD,CAJpB,CAKHkB,OAAO,CAAE,iBAACC,CAAD,CAAoB,CACzB,GAAIA,CAAM,CAACC,KAAX,CAAkB,CACd,MAAOrC,WAAaC,SAAb,CAAuBmC,CAAvB,CACV,CACD,GAAG,CAACwB,CAAJ,CAAW,CACP,SAAQjG,KAAR,CAAcwC,OAAd,GAAwBC,IAAxB,CAA6B7D,CAAS,CAACW,YAAvC,EAAqDyG,IAArD,CAA0D,EAA1D,EACA,SAAQhG,KAAR,CAAcwC,OAAd,GAAwBC,IAAxB,CAA6B7D,CAAS,CAACW,YAAvC,EAAqD0G,MAArD,CAA4D,gCACtD,SAAQ9E,OAAR,CAAgB,EAAhB,EAAoB8F,OAApB,CAA4B,MAA5B,CAAoCxC,CAAM,CAACY,QAAP,CAAgB6B,UAApD,CADsD,CACY,QADxE,CAEH,CACD,IAAK,GAAIC,CAAAA,CAAT,GAAiB1C,CAAAA,CAAM,CAACY,QAAP,CAAgB+B,KAAjC,CAAwC,CACpC,GAAMhB,CAAAA,CAAI,CAAG3B,CAAM,CAACY,QAAP,CAAgB+B,KAAhB,CAAsBD,CAAtB,CAAb,CACA,SAAQnH,KAAR,CAAcwC,OAAd,GAAwBC,IAAxB,CAA6B7D,CAAS,CAACW,YAAvC,EAAqD0G,MAArD,CAA4D,SAAQE,UAAR,CAAmBC,CAAnB,CAA5D,CACH,CACD,GAAMC,CAAAA,CAAK,CAAG,SAAQrG,KAAR,CAAcwC,OAAd,GAAwBC,IAAxB,CAA6B7D,CAAS,CAACW,YAAvC,EAAqDkD,IAArD,CAA0D,OAA1D,EAAmE0C,MAAjF,CACA,GAAIkB,CAAK,CAAG5B,CAAM,CAACY,QAAP,CAAgB6B,UAA5B,CAAuC,CACnC,SAAQlH,KAAR,CAAcwC,OAAd,GAAwBC,IAAxB,CAA6B7D,CAAS,CAACW,YAAvC,EAAqD0G,MAArD,CACI,4FACE,SAAQ9E,OAAR,CAAgB,EAAhB,CADF,CACwB,iBAF5B,CAGH,CACJ,CAxBE,CAyBHuD,KAAK,CAAE,eAACE,CAAD,CAAWC,CAAX,CAAmBC,CAAnB,CAA8B,CACjCzC,UAAaC,SAAb,CAAuBwC,CAAvB,CACH,CA3BE,CA4BHC,UAAU,CAAG,qBAAM,CACf,SAAQC,YAAR,EACH,CA9BE,CAAP,EA+BGC,MA/BH,CA+BU,UAAM,CACZ,SAAQC,WAAR,EACH,CAjCD,CAkCH,CAjED,CAqEA1F,CAAiB,CAACO,SAAlB,CAA4BiF,YAA5B,CAA2C,UAAM,CAC7C,CAAI,CAAChF,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,UAA1B,EAAsCF,IAAtC,EACH,CAFD,CAMA/C,CAAiB,CAACO,SAAlB,CAA4BmF,WAA5B,CAA0C,UAAM,CAC5C,CAAI,CAAClF,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B,UAA1B,EAAsCY,IAAtC,EACH,CAFD,CAMA7D,CAAiB,CAACO,SAAlB,CAA4BqF,eAA5B,CAA8C,UAAM,CAChD,GAAMiC,CAAAA,CAAM,CAAG,CAAI,CAACrH,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B7D,CAAS,CAACO,WAApC,CAAf,CACA,IAAK,GAAIwG,CAAAA,CAAT,GAAc,CAAA,CAAI,CAACvF,gBAAnB,CAAqC,CACjC,GAAMkH,CAAAA,CAAQ,CAAI,CAAI,CAACzH,YAAL,EAAqB,CAAI,CAACO,gBAAL,CAAsBuF,CAAtB,EAAyBpC,EAA/C,CAAqD,uBAArD,CAA6E,EAA9F,CACA,cAAE8D,CAAF,EAAUpB,MAAV,CAAiB,mBAAoB,CAAI,CAAC7F,gBAAL,CAAsBuF,CAAtB,EAAyBpC,EAA7C,CAAkD,KAAlD,CAAwD+D,CAAxD,CAAmE,GAAnE,CAAyE,CAAI,CAAClH,gBAAL,CAAsBuF,CAAtB,EAAyB4B,IAAlG,CACX,WADN,CAEH,CACJ,CAPD,CAYA/H,CAAiB,CAACO,SAAlB,CAA4BmC,mBAA5B,CAAkD,UAAM,CACpD,GAAMmF,CAAAA,CAAM,CAAG,CAAI,CAACrH,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B7D,CAAS,CAACQ,cAApC,CAAf,CAEAkB,UAAEC,IAAF,CAAOC,UAAIgH,UAAJ,CAAe,cAAf,CAA+B,OAA/B,CAAwC,KAAxC,CAAP,EAAuDtG,IAAvD,CAA4D,SAACuG,CAAD,CAAU,CAClE,IAAK,GAAI9B,CAAAA,CAAC,CAAG,CAAb,CAAqB,GAAL,EAAAA,CAAhB,CAA0BA,CAAC,EAA3B,CAA+B,CAC3B,cAAE0B,CAAF,EAAUpB,MAAV,CAAiB,mBAAoBN,CAApB,CAAwB,KAAxB,CAA+B8B,CAAI,CAACR,OAAL,CAAa,KAAb,CAAoBtB,CAApB,CAA/B,CAAwD,WAAzE,CACH,CACJ,CAJD,CAKH,CARD,CAaAnG,CAAiB,CAACO,SAAlB,CAA4BkC,mBAA5B,CAAkD,UAAM,CACpD,GAAMoF,CAAAA,CAAM,CAAG,CAAI,CAACrH,KAAL,CAAWwC,OAAX,GAAqBC,IAArB,CAA0B7D,CAAS,CAACU,eAApC,CAAf,CAEA,IAAK,GAAIqG,CAAAA,CAAT,GAAc,CAAA,CAAI,CAAC/F,WAAnB,CAAgC,CAC5B,cAAEyH,CAAF,EAAUpB,MAAV,CAAiB,mBAAoBN,CAApB,CAAwB,KAAxB,CAA+B,CAAI,CAAC/F,WAAL,CAAiB+F,CAAjB,CAA/B,CAAqD,WAAtE,CACH,CAEJ,CAPD,C,OASoB,QAAP7F,CAAAA,IAAO,CAAA4H,CAAM,CAAI,CACzB,GAAIlI,CAAAA,CAAJ,CAAsBkI,CAAtB,CACJ,C","sourcesContent":["/**\n * ESCO Enrolment AMD module.\n *\n * @module     enrol_manual/quickenrolment\n * @copyright  2016 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport Str from 'core/str';\nimport Notification from 'core/notification';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\n\nconst SELECTORS = {\n    BUTTON_TRIGGER: \"button#enrol_simplesco_adduser\",\n    BUTTON_COLLAPSE: '.collapsible .ftoggler a',\n    BUTTON_LOADMORE: 'button[data-toggle=\"load-more\"]',\n    BUTTON_ENROL: 'button[data-toggle=\"enrol\"]',\n    BUTTON_SEARCH: 'button#search',\n    FIELD_TYPE: 'input[name=\"enrol_simplesco_typesearch\"]',\n    FIELD_ROLES: 'select#enrol_simplesco_assignable_roles',\n    FIELD_DURATION: 'select#enrol_simplesco_assignable_duration',\n    FIELD_SEARCH: 'input#enrolusersearch',\n    FIELD_STARTDATE: 'select#enrol_simplesco_assignable_startdate',\n    AREA_RESULTS: \"div#results\",\n};\n\nconst ESCOUserEnrolment = (options) => {\n    this.course_id = options.course_id;\n    this.instance = options.instance;\n    this.start_dates = options.start_dates;\n    this.role_default = options.role_default;\n    this.init();\n};\n\n/** @var {Modal} modal - */\nESCOUserEnrolment.prototype.modal = null;\n/** @var {number} page - */\nESCOUserEnrolment.prototype.page = 0;\n/** @var {number} perpage - */\nESCOUserEnrolment.prototype.perpage = 25;\n/** @var {number} courseid - */\nESCOUserEnrolment.prototype.course_id = 0;\n/** @var {number} courseid - */\nESCOUserEnrolment.prototype.role_default = 0;\n/** @var {number} enrol_count - */\nESCOUserEnrolment.prototype.enrol_count = 0;\n/** @var {array} assignales_roles - */\nESCOUserEnrolment.prototype.assignales_roles = [];\n/** @var {array} instance - */\nESCOUserEnrolment.prototype.instance = [];\n/** @var {array} start_dates - */\nESCOUserEnrolment.prototype.start_dates = [];\n/** @var {boolean} require_refresh - */\nESCOUserEnrolment.prototype.require_refresh = false;\n\n/** @var {Modal} modal */\nESCOUserEnrolment.prototype.modal = null;\n\nESCOUserEnrolment.prototype.init = () => {\n    const context = this;\n    $.when(\n        Str.get_strings([\n            {component: 'enrol', key: 'enrolusers'}, //0\n            {component: 'enrol', key: 'finishenrollingusers'},\n            {component: 'role', key: 'assignroles'},\n            {component: 'enrol', key: 'none'},\n            {component: 'enrol', key: 'enrolmentoptions'},\n            {component: 'moodle', key: 'startingfrom'},\n            {component: 'enrol', key: 'enrolperiod'},\n            {component: 'enrol', key: 'unlimitedduration'},\n            {component: 'enrol_simplesco', key: 'searchoption'},\n            {component: 'enrol_simplesco', key: 'frommyclass'},\n            {component: 'enrol_simplesco', key: 'fromnetocentre'}, //10\n            {component: 'enrol_simplesco', key: 'byname'},\n            {component: 'enrol_simplesco', key: 'fitre1name'},\n            {component: 'enrol_simplesco', key: 'fitre2name'},\n            {component: 'enrol_simplesco', key: 'fitre3name'},\n            {component: 'enrol_simplesco', key: 'fitre4name'},\n            {component: 'enrol_simplesco', key: 'fitre5name'},\n            {component: 'enrol_simplesco', key: 'fitre6name'},\n            {component: 'enrol', key: 'usersearch'},\n            {component: 'enrol_simplesco', key: 'noresultliste'},\n            {component: 'enrol_simplesco', key: 'allresultliste'}, //20\n            {component: 'enrol', key: 'ajaxxusersfound'},\n            {component: 'enrol', key: 'ajaxnext25'},\n            {component: 'enrol', key: 'enrol'},\n        ]),\n        ModalFactory.create({\n            type: ModalFactory.types.DEFAULT,\n            large: true,\n        }, undefined)\n    ).then(function (strings, modal) {\n        this.strings = strings;\n        this.modal = modal;\n\n        modal.setTitle(strings[0]);\n\n\n        let body = '<div class=\"form-inline mform simplesco\">';\n\n        body += '<div class=\"form-group\">';\n        body += '<label for=\"enrol_simplesco_assignable_roles\">' + strings[2] + ' : </label>';\n        body += '<select id=\"enrol_simplesco_assignable_roles\"><option value=\"\">' + strings[3] + '</option></select>';\n        body += '</div>';\n\n        body += '<fieldset class=\"collapsible collapsed\" id=\"enrolment_options\">';\n        body += '<legend class=\"ftoggler\"><a href=\"#\" class=\"fheader\" role=\"button\" aria-controls=\"enrolment_options\" '\n            + 'aria-expanded=\"false\">' + strings[4] + '</a></legend>';\n        body += '<div class=\"fcontainer\">';\n        body += '<div class=\"startdate form-group\"><label for=\"enrol_simplesco_assignable_startdate\">' + strings[5]\n            + ':</label> <select id=\"enrol_simplesco_assignable_startdate\"></select></div>';\n        body += '<div class=\"duration form-group\"><label for=\"enrol_simplesco_assignable_duration\">' + strings[6]\n            + ' :</label> <select id=\"enrol_simplesco_assignable_duration\"><option value=\"0\" selected=\"selected\">'\n            + strings[7] + '</option></select></div>';\n        body += '</div>';\n        body += '</fieldset>';\n\n        body += '<fieldset class=\"collapsible\" id=\"enrolment_options\">';\n        body += '<legend class=\"ftoggler\"><a href=\"#\" class=\"fheader\" role=\"button\" aria-controls=\"enrolment_options\" '\n            + 'aria-expanded=\"false\">' + strings[8] + '</a></legend>';\n        body += '<div class=\"fcontainer\">';\n        body += '<div class=\"radio\"><label><input type=\"radio\" id=\"enrol_simplesco_typesearch_classe\" '\n            + 'name=\"enrol_simplesco_typesearch\" value=\"classe\" checked=\"checked\"/>' + strings[9] + '</label></div>';\n        body += '<div class=\"radio\"><label><input type=\"radio\" id=\"enrol_simplesco_typesearch_ent\" '\n            + 'name=\"enrol_simplesco_typesearch\" value=\"ent\"/>' + strings[10] + '</label></div>';\n        body += '<div class=\"radio\"><label><input type=\"radio\" id=\"enrol_simplesco_typesearch_nom\" '\n            + 'name=\"enrol_simplesco_typesearch\" value=\"nom\"/>' + strings[11] + '</label></div>';\n\n        body += '<div id=\"enrol_simplesco_selects\">';\n        body += '<div class=\"form-group\"><label for=\"enrol_simplesco_liste1\">' + strings[12]\n            + ' :</label><select id=\"enrol_simplesco_liste1\" name=\"code1\" style=\"max-width: 300px; width:100%;\"></select></div>';\n        body += '<div class=\"form-group\"><label for=\"enrol_simplesco_liste2\">' + strings[13]\n            + ' :</label><select id=\"enrol_simplesco_liste2\" name=\"code2\" style=\"max-width: 300px; width:100%;\"></select></div>';\n        body += '<div class=\"form-group\"><label for=\"enrol_simplesco_liste3\">' + strings[14]\n            + ' :</label><select id=\"enrol_simplesco_liste3\" name=\"code3\" style=\"max-width: 300px; width:100%;\"></select></div>';\n        body += '<div class=\"form-group\"><label for=\"enrol_simplesco_liste4\">' + strings[15]\n            + ' :</label><select id=\"enrol_simplesco_liste4\" name=\"code4\" style=\"max-width: 300px; width:100%;\"></select></div>';\n        body += '<div class=\"form-group\"><label for=\"enrol_simplesco_liste5\">' + strings[16]\n            + ' :</label><select id=\"enrol_simplesco_liste5\" name=\"code5\" style=\"max-width: 300px; width:100%;\"></select></div>';\n        body += '</div>';\n        body += '<div id=\"enrol_simplesco_input form-group\">';\n        body += '<label for=\"enrolusersearch\">' + strings[17]\n            + ' :</label> <input type=\"text\" id=\"enrolusersearch\" value=\"\" class=\"form-control\" '\n            + 'style=\"max-width: 300px; width:100%;\"/>';\n        body += '</div>';\n        body += '<div class=\"text-center\"><button class=\"btn btn-primary\" id=\"search\"> ' + strings[18] + '</button></div>';\n        body += '</div>';\n        body += '</fieldset>';\n\n        body += '<div id=\"results\"></div>';\n\n        body += '<div id=\"loading\" style=\"display:none;\">CHARGEMENT</div>';\n\n        body += '</div>';\n        modal.setBody(body);\n\n        modal.setFooter('<button class=\"btn btn-primary\" data-action=\"hide\">' + strings[1] + '</button>');\n\n        modal.getRoot().on(ModalEvents.hidden, () => {\n            if(context.require_refresh){\n                location.reload();\n            }\n        });\n\n        this.bindEvents();\n        this.displayLists();\n        this.populateRoles();\n        this.updateStartDateList();\n        this.updateDurationsList();\n    }.bind(this)).fail(Notification.exception);\n};\n\n/**\n * Bind events needed for the modal to work\n */\nESCOUserEnrolment.prototype.bindEvents = () => {\n    const context = this;\n    $(\"body\").on(\"click\", SELECTORS.BUTTON_TRIGGER, () => {\n        context.modal.show();\n    });\n\n    this.modal.getBody().find(SELECTORS.FIELD_TYPE).on(\"change\", () => {\n        context.displayLists();\n    });\n\n    this.modal.getBody().find(SELECTORS.BUTTON_COLLAPSE).on(\"click\", (event) => {\n        event.preventDefault();\n        $(this).closest(\".collapsible\").toggleClass(\"collapsed\");\n        return false;\n    });\n\n    this.modal.getBody().find(\"#enrol_simplesco_liste1\").on(\"change\", () => {\n        context.refreshSearchLists(this);\n    });\n\n    this.modal.getBody().find(SELECTORS.BUTTON_SEARCH).on(\"click\", (event) => {\n        event.preventDefault();\n        context.search();\n        return false;\n    });\n    this.modal.getBody().find(SELECTORS.FIELD_SEARCH).on(\"keypress\", (event) => {\n        if(event.which === 13){\n            event.preventDefault();\n            context.search();\n            return false;\n        }\n    });\n\n    this.modal.getBody().on(\"click\", SELECTORS.BUTTON_LOADMORE, (event) => {\n        event.preventDefault();\n        context.search(true);\n        return false;\n    });\n    this.modal.getBody().on(\"click\", SELECTORS.BUTTON_ENROL, (event) => {\n        event.preventDefault();\n        const userid = $(this).attr(\"value\");\n        context.enrol(userid);\n        return false;\n    });\n};\n\n/**\n * Change the display of listes based on selected search type\n */\nESCOUserEnrolment.prototype.displayLists = () => {\n    switch (this.modal.getBody().find(SELECTORS.FIELD_TYPE + ':checked').val()) {\n        case \"classe\" :\n            this.modal.getBody().find(\"#enrol_simplesco_liste1\").closest('.form-group').show();\n            this.modal.getBody().find(\"#enrol_simplesco_liste2\").closest('.form-group').show();\n            this.modal.getBody().find(\"#enrol_simplesco_liste3\").closest('.form-group').show();\n            this.modal.getBody().find(\"#enrol_simplesco_liste4\").closest('.form-group').show();\n            this.modal.getBody().find(\"#enrol_simplesco_liste5\").closest('.form-group').hide();\n            this.refreshSearchLists();\n            break;\n        case \"ent\" :\n            this.modal.getBody().find(\"#enrol_simplesco_liste1\").closest('.form-group').show();\n            this.modal.getBody().find(\"#enrol_simplesco_liste2\").closest('.form-group').show();\n            this.modal.getBody().find(\"#enrol_simplesco_liste3\").closest('.form-group').show();\n            this.modal.getBody().find(\"#enrol_simplesco_liste4\").closest('.form-group').show();\n            this.modal.getBody().find(\"#enrol_simplesco_liste5\").closest('.form-group').show();\n            this.refreshSearchLists();\n            break;\n        case \"nom\" :\n            this.modal.getBody().find(\"#enrol_simplesco_liste1\").closest('.form-group').hide();\n            this.modal.getBody().find(\"#enrol_simplesco_liste2\").closest('.form-group').hide();\n            this.modal.getBody().find(\"#enrol_simplesco_liste3\").closest('.form-group').hide();\n            this.modal.getBody().find(\"#enrol_simplesco_liste4\").closest('.form-group').hide();\n            this.modal.getBody().find(\"#enrol_simplesco_liste5\").closest('.form-group').hide();\n            break;\n    }\n};\n\n/**\n * Enrol the given userid\n */\nESCOUserEnrolment.prototype.enrol = (userid) => {\n    const context = this;\n    const parameters = {\n        id: this.course_id,\n        sesskey: M.cfg.sesskey,\n        action: 'enrol',\n        enrolid: this.instance.id,\n        userid : userid,\n        role : this.modal.getBody().find(SELECTORS.FIELD_ROLES).val(),\n        startdate : this.modal.getBody().find(SELECTORS.FIELD_STARTDATE).val(),\n        duration : this.modal.getBody().find(SELECTORS.FIELD_DURATION).val(),\n        recovergrades : 0,\n    };\n    $.ajax({\n        url: M.cfg.wwwroot + '/enrol/simplesco/ajax.php',\n        method: 'POST',\n        dataType: 'json',\n        data: build_querystring(parameters),\n        success: (result, statut) => {\n            if (result.error) {\n                return Notification.exception(result);\n            }\n            context.require_refresh = true;\n            context.enrol_count++;\n            context.modal.getBody().find(SELECTORS.AREA_RESULTS).find('div.user[rel=\"' + userid + '\"]').addClass(\"enrolled\");\n        },\n        error: (resultat, statut, erreur) => {\n            Notification.exception(erreur);\n        },\n        beforeSend : () => {\n            context.startLoading();\n        }\n    }).always(() => {\n        context.stopLoading();\n    });\n};\n\n/**\n * Load the list of roles from the database for given course\n */\nESCOUserEnrolment.prototype.populateRoles = () => {\n    if (this.assignales_roles.length > 0) {\n        return this.updateRolesList();\n    }\n    const context = this;\n    $.ajax({\n        url: M.cfg.wwwroot + '/enrol/ajax.php',\n        method: 'POST',\n        dataType: 'json',\n        data: 'id=' + this.course_id + '&action=getassignable&sesskey=' + M.cfg.sesskey,\n        success: (result, statut) => {\n            if (result.error) {\n                return Notification.exception(result);\n            }\n            context.assignales_roles = result.response;\n            context.updateRolesList();\n        },\n        error: (resultat, statut, erreur) => {\n            Notification.exception(erreur);\n        },\n        beforeSend : () => {\n            context.startLoading();\n        }\n    }).always(() => {\n        context.stopLoading();\n    });\n};\n\n/**\n * Based on the type of search, refresh content of search lists\n */\nESCOUserEnrolment.prototype.refreshSearchLists = (listes) => {\n    let code1 = this.modal.getBody().find(\"select#enrol_simplesco_liste1\").val();\n    if (listes == undefined) {\n        listes = \"12345\";\n    } else if (typeof(listes) == \"object\") {\n        listes = '345';\n    }\n    if (code1 === null) {\n        code1 = \"\";\n    }\n    const parameters = {\n        id: this.course_id,\n        action: 'getListes',\n        sesskey: M.cfg.sesskey,\n        code1: code1,\n        option: this.modal.getBody().find(SELECTORS.FIELD_TYPE + ':checked').val(),\n        numliste: listes\n    };\n    const context = this;\n    $.ajax({\n        url: M.cfg.wwwroot + '/enrol/simplesco/ajax.php',\n        method: 'POST',\n        dataType: 'json',\n        data: build_querystring(parameters),\n        success: (result, statut) => {\n            if (result.error) {\n                return Notification.exception(result);\n            }\n            for (let i = 0; i < parameters.numliste.length; i++) {\n                const id_liste = parameters.numliste.charAt(i);\n                const $liste = context.modal.getBody().find(\"#enrol_simplesco_liste\" + id_liste);\n                const value = result.response[\"defaut\" + id_liste];\n                $liste.html(\"\");\n                if (result.response[id_liste].length == 0) {\n                    $liste.append('<option value=\"\">' + context.strings[19] + '</option>');\n                } else {\n                    for (let j in result.response[id_liste]) {\n                        $liste.append('<option value=\"' + j + '\">' + result.response[id_liste][j] + '</option>');\n                    }\n                    if (id_liste != 1) {\n                        $liste.append('<option value=\"\">' + context.strings[20] + '</option>');\n                    }\n                }\n                $liste.val(value);\n            }\n        },\n        error: (resultat, statut, erreur) => {\n            Notification.exception(erreur);\n        },\n        beforeSend : () => {\n            context.startLoading();\n        }\n    }).always(() => {\n        context.stopLoading();\n    });\n};\n\n/**\n * Render user data to HTML format\n * @param user\n */\nESCOUserEnrolment.prototype.renderUser = (user) => {\n    const count = this.modal.getBody().find(SELECTORS.AREA_RESULTS).find(\".user\").length;\n    let user_html = '<div class=\"user item clearfix\" rel=\"' + user.id + '\">';\n\n    user_html += '<div class=\"count\">' + (count + 1) + '</div>';\n    user_html += '<div class=\"picture\">' + user.picture + '</div>';\n\n    user_html += '<div class=\"details\">';\n    user_html += '<div class=\"fullname\">' + user.fullname + '</div>';\n    user_html += '<div class=\"extrafields\">' + user.extrafields + '</div>';\n    user_html += '</div>';\n\n    user_html += '<div class=\"options\">';\n    user_html += '<button class=\"btn btn-success\" data-toggle=\"enrol\" value=\"'+ user.id+'\">' + this.strings[23] + '</button>';\n    user_html += '</div>';\n\n    user_html += '</div>';\n\n    return user_html;\n};\n/**\n * Send the send request to server(s) and then process the results\n */\nESCOUserEnrolment.prototype.search = (append) => {\n    const context = this;\n    let type;\n\n    if(append){\n        this.page++;\n    }else{\n        this.page = 0;\n    }\n    if ([\"classe\", \"ent\"].indexOf(this.modal.getBody().find(SELECTORS.FIELD_TYPE + ':checked').val()) !== -1) {\n        type = 'ldap';\n    }\n    const parameters = {\n        id: this.course_id,\n        sesskey: M.cfg.sesskey,\n        action: 'searchusers',\n        search: this.modal.getBody().find(SELECTORS.FIELD_SEARCH).val(),\n        option: this.modal.getBody().find(SELECTORS.FIELD_TYPE + ':checked').val(),\n        numliste: \"12345\",\n        page: this.page,\n        perpage: this.perpage,\n        enrolcount: this.enrol_count,\n        enrolid: this.instance.id,\n        type: type,\n        code1: this.modal.getBody().find(\"#enrol_simplesco_liste1\").val(),\n        code2: this.modal.getBody().find(\"#enrol_simplesco_liste2\").val(),\n        code3: this.modal.getBody().find(\"#enrol_simplesco_liste3\").val(),\n        code4: this.modal.getBody().find(\"#enrol_simplesco_liste4\").val(),\n        code5: this.modal.getBody().find(\"#enrol_simplesco_liste5\").val(),\n    };\n    context.modal.getBody().find(SELECTORS.AREA_RESULTS).find('button[data-toggle=\"load-more\"]').remove();\n    $.ajax({\n        url: M.cfg.wwwroot + '/enrol/simplesco/ajax.php',\n        method: 'POST',\n        dataType: 'json',\n        data: build_querystring(parameters),\n        success: (result, statut) => {\n            if (result.error) {\n                return Notification.exception(result);\n            }\n            if(!append){\n                context.modal.getBody().find(SELECTORS.AREA_RESULTS).html(\"\");\n                context.modal.getBody().find(SELECTORS.AREA_RESULTS).append('<div class=\"total_results\">'\n                    + context.strings[21].replace(\"{$a}\", result.response.totalusers) + '</div>');\n            }\n            for (let line in result.response.users) {\n                const user = result.response.users[line];\n                context.modal.getBody().find(SELECTORS.AREA_RESULTS).append(context.renderUser(user));\n            }\n            const count = context.modal.getBody().find(SELECTORS.AREA_RESULTS).find(\".item\").length;\n            if (count < result.response.totalusers){\n                context.modal.getBody().find(SELECTORS.AREA_RESULTS).append(\n                    '<div class=\"text-center\"><button class=\"btn btn-secondary\" data-toggle=\"load-more\">'\n                    + context.strings[22] + '</button></div>');\n            }\n        },\n        error: (resultat, statut, erreur) => {\n            Notification.exception(erreur);\n        },\n        beforeSend : () => {\n            context.startLoading();\n        }\n    }).always(() => {\n        context.stopLoading();\n    });\n};\n/**\n * Display the loading screen\n */\nESCOUserEnrolment.prototype.startLoading = () => {\n    this.modal.getBody().find(\"#loading\").show();\n};\n/**\n * Show the loading screen\n */\nESCOUserEnrolment.prototype.stopLoading = () => {\n    this.modal.getBody().find(\"#loading\").hide();\n};\n/**\n * Update the roles select field\n */\nESCOUserEnrolment.prototype.updateRolesList = () => {\n    const select = this.modal.getBody().find(SELECTORS.FIELD_ROLES);\n    for (let i in this.assignales_roles) {\n        const selected = (this.role_default == this.assignales_roles[i].id) ? 'selected=\"selected\"' : \"\";\n        $(select).append('<option value=\"' + this.assignales_roles[i].id + '\" '+ selected + '>' + this.assignales_roles[i].name\n            + '</option>');\n    }\n};\n\n/**\n * Update the durations select field\n */\nESCOUserEnrolment.prototype.updateDurationsList = () => {\n    const select = this.modal.getBody().find(SELECTORS.FIELD_DURATION);\n\n    $.when(Str.get_string('durationdays', 'enrol', '{a}')).then((text) => {\n        for (let i = 1; i <= 365; i++) {\n            $(select).append('<option value=\"' + i + '\">' + text.replace('{a}', i) + '</option>');\n        }\n    });\n};\n\n/**\n * Update the start date select field\n */\nESCOUserEnrolment.prototype.updateStartDateList = () => {\n    const select = this.modal.getBody().find(SELECTORS.FIELD_STARTDATE);\n\n    for (let i in this.start_dates) {\n        $(select).append('<option value=\"' + i + '\">' + this.start_dates[i] + '</option>');\n    }\n\n};\n\nexport const init = config => {\n    (new ESCOUserEnrolment(config));\n};"],"file":"userenrolment.min.js"}