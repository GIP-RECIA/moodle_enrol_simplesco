{"version":3,"sources":["../src/userenrolment.js"],"names":["SELECTORS","BUTTON_TRIGGER","BUTTON_COLLAPSE","BUTTON_LOADMORE","BUTTON_ENROL","BUTTON_SEARCH","FIELD_TYPE","FIELD_ROLES","FIELD_DURATION","FIELD_SEARCH","FIELD_STARTDATE","AREA_RESULTS","ESCOUserEnrolment","options","course_id","instance","start_dates","role_default","init","Promise","all","component","key","ModalFactory","create","type","types","DEFAULT","large","then","values","strings","modal","setTitle","body","setBody","setFooter","getRoot","on","ModalEvents","hidden","require_refresh","location","reload","bindEvents","displayLists","populateRoles","updateStartDateList","updateDurationsList","catch","Notification","exception","document","addEventListener","event","target","closest","preventDefault","show","getBody","find","classList","toggle","refreshSearchLists","search","which","userid","attr","enrol","val","hide","parameters","id","sesskey","M","cfg","action","enrolid","role","startdate","duration","recovergrades","$","ajax","url","wwwroot","method","dataType","data","build_querystring","success","result","error","enrol_count","addClass","resultat","statut","erreur","beforeSend","startLoading","always","stopLoading","assignales_roles","length","updateRolesList","response","listes","code1","option","numliste","i","id_liste","charAt","$liste","value","html","append","j","user","count","user_html","picture","fullname","extrafields","page","indexOf","perpage","enrolcount","code2","code3","code4","code5","remove","replace","totalusers","line","users","renderUser","select","selected","name","when","text","config"],"mappings":"2JAAA,a,+DASA,OAEA,OACA,OACA,O,mwBAEMA,CAAAA,CAAS,CAAG,CACdC,cAAc,CAAE,gCADF,CAEdC,eAAe,CAAE,0BAFH,CAGdC,eAAe,CAAE,mCAHH,CAIdC,YAAY,CAAE,+BAJA,CAKdC,aAAa,CAAE,eALD,CAMdC,UAAU,CAAE,4CANE,CAOdC,WAAW,CAAE,yCAPC,CAQdC,cAAc,CAAE,4CARF,CASdC,YAAY,CAAE,uBATA,CAUdC,eAAe,CAAE,6CAVH,CAWdC,YAAY,CAAE,aAXA,C,CAcZC,C,YA0BF,WAAYC,CAAZ,CAAqB,4BAxBX,IAwBW,iBAtBb,IAsBa,gBApBd,CAoBc,mBAlBX,EAkBW,qBAhBT,CAgBS,wBAdN,CAcM,uBAZP,CAYO,4BAVF,EAUE,oBARV,EAQU,uBANP,EAMO,8CAFb,IAEa,EACjB,KAAKC,SAAL,CAAiBD,CAAO,CAACC,SAAzB,CACA,KAAKC,QAAL,CAAgBF,CAAO,CAACE,QAAxB,CACA,KAAKC,WAAL,CAAmBH,CAAO,CAACG,WAA3B,CACA,KAAKC,YAAL,CAAoBJ,CAAO,CAACI,YAA5B,CACA,KAAKC,IAAL,EACH,C,sCAEM,YACHC,OAAO,CAACC,GAAR,CAAY,CACR,kBAAY,CACR,CAACC,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,YAA1B,CADQ,CAER,CAACD,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,sBAA1B,CAFQ,CAGR,CAACD,SAAS,CAAE,MAAZ,CAAoBC,GAAG,CAAE,aAAzB,CAHQ,CAIR,CAACD,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,MAA1B,CAJQ,CAKR,CAACD,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,kBAA1B,CALQ,CAMR,CAACD,SAAS,CAAE,QAAZ,CAAsBC,GAAG,CAAE,cAA3B,CANQ,CAOR,CAACD,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,aAA1B,CAPQ,CAQR,CAACD,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,mBAA1B,CARQ,CASR,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,cAApC,CATQ,CAUR,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,aAApC,CAVQ,CAWR,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,gBAApC,CAXQ,CAYR,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,QAApC,CAZQ,CAaR,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,YAApC,CAbQ,CAcR,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,YAApC,CAdQ,CAeR,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,YAApC,CAfQ,CAgBR,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,YAApC,CAhBQ,CAiBR,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,YAApC,CAjBQ,CAkBR,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,YAApC,CAlBQ,CAmBR,CAACD,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,YAA1B,CAnBQ,CAoBR,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,eAApC,CApBQ,CAqBR,CAACD,SAAS,CAAE,iBAAZ,CAA+BC,GAAG,CAAE,gBAApC,CArBQ,CAsBR,CAACD,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,iBAA1B,CAtBQ,CAuBR,CAACD,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,YAA1B,CAvBQ,CAwBR,CAACD,SAAS,CAAE,OAAZ,CAAqBC,GAAG,CAAE,OAA1B,CAxBQ,CAAZ,CADQ,CA2BRC,UAAaC,MAAb,CAAoB,CAChBC,IAAI,CAAEF,UAAaG,KAAb,CAAmBC,OADT,CAEhBC,KAAK,GAFW,CAApB,QA3BQ,CAAZ,EA+BCC,IA/BD,CA+BM,SAAAC,CAAM,CAAI,CACZ,CAAI,CAACC,OAAL,CAAeD,CAAM,CAAC,CAAD,CAArB,CACA,CAAI,CAACE,KAAL,CAAaF,CAAM,CAAC,CAAD,CAAnB,CAEA,CAAI,CAACE,KAAL,CAAWC,QAAX,CAAoB,CAAI,CAACF,OAAL,CAAa,CAAb,CAApB,EAEA,GAAMG,CAAAA,CAAI,4JAEsC,CAAI,CAACH,OAAL,CAAa,CAAb,CAFtC,wGAGuD,CAAI,CAACA,OAAL,CAAa,CAAb,CAHvD,0SAOkB,CAAI,CAACA,OAAL,CAAa,CAAb,CAPlB,uKAS4E,CAAI,CAACA,OAAL,CAAa,CAAb,CAT5E,gNAW0E,CAAI,CAACA,OAAL,CAAa,CAAb,CAX1E,wJAaJ,CAAI,CAACA,OAAL,CAAa,CAAb,CAbI,+TAkBkB,CAAI,CAACA,OAAL,CAAa,CAAb,CAlBlB,sQAqBgE,CAAI,CAACA,OAAL,CAAa,CAAb,CArBhE,qMAuB2C,CAAI,CAACA,OAAL,CAAa,EAAb,CAvB3C,qMAyB2C,CAAI,CAACA,OAAL,CAAa,EAAb,CAzB3C,0JA2BoD,CAAI,CAACA,OAAL,CAAa,EAAb,CA3BpD,kOA6BoD,CAAI,CAACA,OAAL,CAAa,EAAb,CA7BpD,kOA+BoD,CAAI,CAACA,OAAL,CAAa,EAAb,CA/BpD,kOAiCoD,CAAI,CAACA,OAAL,CAAa,EAAb,CAjCpD,kOAmCoD,CAAI,CAACA,OAAL,CAAa,EAAb,CAnCpD,gRAuCqB,CAAI,CAACA,OAAL,CAAa,EAAb,CAvCrB,6QA0C8D,CAAI,CAACA,OAAL,CAAa,EAAb,CA1C9D,sMAAV,CAgDA,CAAI,CAACC,KAAL,CAAWG,OAAX,CAAmBD,CAAnB,EAEA,CAAI,CAACF,KAAL,CAAWI,SAAX,kEAA2E,CAAI,CAACL,OAAL,CAAa,CAAb,CAA3E,eAEA,CAAI,CAACC,KAAL,CAAWK,OAAX,GAAqBC,EAArB,CAAwBC,UAAYC,MAApC,CAA4C,UAAM,CAC9C,GAAG,CAAI,CAACC,eAAR,CAAwB,CACpBC,QAAQ,CAACC,MAAT,EACH,CACJ,CAJD,EAMA,CAAI,CAACC,UAAL,GACA,CAAI,CAACC,YAAL,GACA,CAAI,CAACC,aAAL,GACA,CAAI,CAACC,mBAAL,GACA,CAAI,CAACC,mBAAL,EACH,CApGD,EAqGCC,KArGD,CAqGOC,UAAaC,SArGpB,CAsGH,C,+CAKY,YACTC,QAAQ,CAACC,gBAAT,CAA0B,OAA1B,CAAmC,SAAAC,CAAK,CAAI,CACxC,GAAIA,CAAK,CAACC,MAAN,CAAaC,OAAb,CAAqBxD,CAAS,CAACC,cAA/B,CAAJ,CAAoD,CAChDqD,CAAK,CAACG,cAAN,GACA,CAAI,CAACzB,KAAL,CAAW0B,IAAX,EAEH,CACJ,CAND,EAQA,KAAK1B,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACM,UAApC,EAAgDgC,EAAhD,CAAmD,QAAnD,CAA6D,UAAM,CAC/D,CAAI,CAACO,YAAL,EACH,CAFD,EAIA,KAAKb,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACE,eAApC,EAAqDoC,EAArD,CAAwD,OAAxD,CAAiE,SAACgB,CAAD,CAAW,CACxEA,CAAK,CAACG,cAAN,GACAH,CAAK,CAACC,MAAN,CAAaC,OAAb,CAAqB,cAArB,EAAqCK,SAArC,CAA+CC,MAA/C,CAAsD,WAAtD,EACA,QACH,CAJD,EAMA,KAAK9B,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDtB,EAArD,CAAwD,QAAxD,CAAkE,SAACgB,CAAD,CAAW,CACzE,CAAI,CAACS,kBAAL,CAAwBT,CAAK,CAACC,MAA9B,CACH,CAFD,EAIA,KAAKvB,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACK,aAApC,EAAmDiC,EAAnD,CAAsD,OAAtD,CAA+D,SAACgB,CAAD,CAAW,CACtEA,CAAK,CAACG,cAAN,GACA,CAAI,CAACO,MAAL,GACA,QACH,CAJD,EAKA,KAAKhC,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACS,YAApC,EAAkD6B,EAAlD,CAAqD,UAArD,CAAiE,SAACgB,CAAD,CAAW,CACxE,GAAmB,EAAhB,GAAAA,CAAK,CAACW,KAAT,CAAsB,CAClBX,CAAK,CAACG,cAAN,GACA,CAAI,CAACO,MAAL,GACA,QACH,CACJ,CAND,EAQA,KAAKhC,KAAL,CAAW2B,OAAX,GAAqBrB,EAArB,CAAwB,OAAxB,CAAiCtC,CAAS,CAACG,eAA3C,CAA4D,SAACmD,CAAD,CAAW,CACnEA,CAAK,CAACG,cAAN,GACA,CAAI,CAACO,MAAL,KACA,QACH,CAJD,EAKA,KAAKhC,KAAL,CAAW2B,OAAX,GAAqBrB,EAArB,CAAwB,OAAxB,CAAiCtC,CAAS,CAACI,YAA3C,CAAyD,SAACkD,CAAD,CAAW,CAChEA,CAAK,CAACG,cAAN,GACA,GAAMS,CAAAA,CAAM,CAAG,cAAEZ,CAAK,CAACC,MAAR,EAAgBY,IAAhB,CAAqB,OAArB,CAAf,CACA,CAAI,CAACC,KAAL,CAAWF,CAAX,EACA,QACH,CALD,CAMH,C,mDAKc,CACX,OAAQ,KAAKlC,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACM,UAAV,CAAuB,UAAjD,EAA6D+D,GAA7D,EAAR,EACI,IAAK,QAAL,CACI,KAAKrC,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDJ,OAArD,CAA6D,aAA7D,EAA4EE,IAA5E,GACA,KAAK1B,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDJ,OAArD,CAA6D,aAA7D,EAA4EE,IAA5E,GACA,KAAK1B,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDJ,OAArD,CAA6D,aAA7D,EAA4EE,IAA5E,GACA,KAAK1B,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDJ,OAArD,CAA6D,aAA7D,EAA4EE,IAA5E,GACA,KAAK1B,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDJ,OAArD,CAA6D,aAA7D,EAA4Ec,IAA5E,GACA,KAAKP,kBAAL,GACA,MACJ,IAAK,KAAL,CACI,KAAK/B,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDJ,OAArD,CAA6D,aAA7D,EAA4EE,IAA5E,GACA,KAAK1B,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDJ,OAArD,CAA6D,aAA7D,EAA4EE,IAA5E,GACA,KAAK1B,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDJ,OAArD,CAA6D,aAA7D,EAA4EE,IAA5E,GACA,KAAK1B,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDJ,OAArD,CAA6D,aAA7D,EAA4EE,IAA5E,GACA,KAAK1B,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDJ,OAArD,CAA6D,aAA7D,EAA4EE,IAA5E,GACA,KAAKK,kBAAL,GACA,MACJ,IAAK,KAAL,CACI,KAAK/B,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDJ,OAArD,CAA6D,aAA7D,EAA4Ec,IAA5E,GACA,KAAKtC,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDJ,OAArD,CAA6D,aAA7D,EAA4Ec,IAA5E,GACA,KAAKtC,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDJ,OAArD,CAA6D,aAA7D,EAA4Ec,IAA5E,GACA,KAAKtC,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDJ,OAArD,CAA6D,aAA7D,EAA4Ec,IAA5E,GACA,KAAKtC,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDJ,OAArD,CAA6D,aAA7D,EAA4Ec,IAA5E,GACA,MAvBR,CAyBH,C,oCAKKJ,C,CAAQ,YACJK,CAAU,CAAG,CACfC,EAAE,CAAE,KAAK1D,SADM,CAEf2D,OAAO,CAAEC,CAAC,CAACC,GAAF,CAAMF,OAFA,CAGfG,MAAM,CAAE,OAHO,CAIfC,OAAO,CAAE,KAAK9D,QAAL,CAAcyD,EAJR,CAKfN,MAAM,CAAGA,CALM,CAMfY,IAAI,CAAG,KAAK9C,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACO,WAApC,EAAiD8D,GAAjD,EANQ,CAOfU,SAAS,CAAG,KAAK/C,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACU,eAApC,EAAqD2D,GAArD,EAPG,CAQfW,QAAQ,CAAG,KAAKhD,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACQ,cAApC,EAAoD6D,GAApD,EARI,CASfY,aAAa,CAAG,CATD,CADT,CAYVC,UAAEC,IAAF,CAAO,CACHC,GAAG,CAAEV,CAAC,CAACC,GAAF,CAAMU,OAAN,CAAgB,2BADlB,CAEHC,MAAM,CAAE,MAFL,CAGHC,QAAQ,CAAE,MAHP,CAIHC,IAAI,CAAEC,iBAAiB,CAAClB,CAAD,CAJpB,CAKHmB,OAAO,CAAE,iBAACC,CAAD,CAAoB,CACzB,GAAIA,CAAM,CAACC,KAAX,CAAkB,CACd,MAAO1C,WAAaC,SAAb,CAAuBwC,CAAvB,CACV,CACD,CAAI,CAAClD,eAAL,IACA,CAAI,CAACoD,WAAL,GACA,CAAI,CAAC7D,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACW,YAApC,EAAkDiD,IAAlD,CAAuD,kBAAmBM,CAAnB,CAA4B,KAAnF,EAAyF4B,QAAzF,CAAkG,UAAlG,CACH,CAZE,CAaHF,KAAK,CAAE,eAACG,CAAD,CAAWC,CAAX,CAAmBC,CAAnB,CAA8B,CACjC/C,UAAaC,SAAb,CAAuB8C,CAAvB,CACH,CAfE,CAgBHC,UAAU,CAAG,qBAAM,CACf,CAAI,CAACC,YAAL,EACH,CAlBE,CAAP,EAmBGC,MAnBH,CAmBU,UAAM,CACZ,CAAI,CAACC,WAAL,EACH,CArBD,CAsBH,C,qDAKe,YACZ,GAAmC,CAA/B,MAAKC,gBAAL,CAAsBC,MAA1B,CAAsC,CAClC,MAAO,MAAKC,eAAL,EACV,CACDtB,UAAEC,IAAF,CAAO,CACHC,GAAG,CAAEV,CAAC,CAACC,GAAF,CAAMU,OAAN,CAAgB,iBADlB,CAEHC,MAAM,CAAE,MAFL,CAGHC,QAAQ,CAAE,MAHP,CAIHC,IAAI,CAAE,MAAQ,KAAK1E,SAAb,CAAyB,gCAAzB,CAA4D4D,CAAC,CAACC,GAAF,CAAMF,OAJrE,CAKHiB,OAAO,CAAE,iBAACC,CAAD,CAAoB,CACzB,GAAIA,CAAM,CAACC,KAAX,CAAkB,CACd,MAAO1C,WAAaC,SAAb,CAAuBwC,CAAvB,CACV,CACD,CAAI,CAACW,gBAAL,CAAwBX,CAAM,CAACc,QAA/B,CACA,CAAI,CAACD,eAAL,EACH,CAXE,CAYHZ,KAAK,CAAE,eAACG,CAAD,CAAWC,CAAX,CAAmBC,CAAnB,CAA8B,CACjC/C,UAAaC,SAAb,CAAuB8C,CAAvB,CACH,CAdE,CAeHC,UAAU,CAAG,qBAAM,CACf,CAAI,CAACC,YAAL,EACH,CAjBE,CAAP,EAkBGC,MAlBH,CAkBU,UAAM,CACZ,CAAI,CAACC,WAAL,EACH,CApBD,CAqBH,C,8DAKkBK,C,CAAQ,YACnBC,CAAK,CAAG,KAAK3E,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,+BAA1B,EAA2DS,GAA3D,EADW,CAEvB,GAAIqC,CAAM,QAAV,CAAyB,CACrBA,CAAM,CAAG,OACZ,CAFD,IAEO,IAAsB,QAAlB,IAAOA,CAAP,CAAJ,CAAgC,CACnCA,CAAM,CAAG,KACZ,CACD,GAAc,IAAV,GAAAC,CAAJ,CAAoB,CAChBA,CAAK,CAAG,EACX,CACD,GAAMpC,CAAAA,CAAU,CAAG,CACfC,EAAE,CAAE,KAAK1D,SADM,CAEf8D,MAAM,CAAE,WAFO,CAGfH,OAAO,CAAEC,CAAC,CAACC,GAAF,CAAMF,OAHA,CAIfkC,KAAK,CAAEA,CAJQ,CAKfC,MAAM,CAAE,KAAK5E,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACM,UAAV,CAAuB,UAAjD,EAA6D+D,GAA7D,EALO,CAMfwC,QAAQ,CAAEH,CANK,CAAnB,CAQAxB,UAAEC,IAAF,CAAO,CACHC,GAAG,CAAEV,CAAC,CAACC,GAAF,CAAMU,OAAN,CAAgB,2BADlB,CAEHC,MAAM,CAAE,MAFL,CAGHC,QAAQ,CAAE,MAHP,CAIHC,IAAI,CAAEC,iBAAiB,CAAClB,CAAD,CAJpB,CAKHmB,OAAO,CAAE,iBAACC,CAAD,CAAoB,CACzB,GAAIA,CAAM,CAACC,KAAX,CAAkB,CACd,MAAO1C,WAAaC,SAAb,CAAuBwC,CAAvB,CACV,CACD,IAAK,GAAImB,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGvC,CAAU,CAACsC,QAAX,CAAoBN,MAAxC,CAAgDO,CAAC,EAAjD,CAAqD,IAC3CC,CAAAA,CAAQ,CAAGxC,CAAU,CAACsC,QAAX,CAAoBG,MAApB,CAA2BF,CAA3B,CADgC,CAE3CG,CAAM,CAAG,CAAI,CAACjF,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA2BmD,CAArD,CAFkC,CAG3CG,CAAK,CAAGvB,CAAM,CAACc,QAAP,CAAgB,SAAWM,CAA3B,CAHmC,CAIjDE,CAAM,CAACE,IAAP,CAAY,EAAZ,EACA,GAAwC,CAApC,EAAAxB,CAAM,CAACc,QAAP,CAAgBM,CAAhB,EAA0BR,MAA9B,CAA2C,CACvCU,CAAM,CAACG,MAAP,8BAAkC,CAAI,CAACrF,OAAL,CAAa,EAAb,CAAlC,cACH,CAFD,IAEO,CACH,IAAK,GAAIsF,CAAAA,CAAT,GAAc1B,CAAAA,CAAM,CAACc,QAAP,CAAgBM,CAAhB,CAAd,CAAyC,CACrCE,CAAM,CAACG,MAAP,2BAAgCC,CAAhC,eAAsC1B,CAAM,CAACc,QAAP,CAAgBM,CAAhB,EAA0BM,CAA1B,CAAtC,cACH,CACD,GAAgB,CAAZ,EAAAN,CAAJ,CAAmB,CACfE,CAAM,CAACG,MAAP,8BAAkC,CAAI,CAACrF,OAAL,CAAa,EAAb,CAAlC,cACH,CACJ,CACDkF,CAAM,CAAC5C,GAAP,CAAW6C,CAAX,CACH,CACJ,CA1BE,CA2BHtB,KAAK,CAAE,eAACG,CAAD,CAAWC,CAAX,CAAmBC,CAAnB,CAA8B,CACjC/C,UAAaC,SAAb,CAAuB8C,CAAvB,CACH,CA7BE,CA8BHC,UAAU,CAAG,qBAAM,CACf,CAAI,CAACC,YAAL,EACH,CAhCE,CAAP,EAiCGC,MAjCH,CAiCU,UAAM,CACZ,CAAI,CAACC,WAAL,EACH,CAnCD,CAoCH,C,8CAMUiB,C,CAAM,IACPC,CAAAA,CAAK,CAAG,KAAKvF,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACW,YAApC,EAAkDiD,IAAlD,CAAuD,OAAvD,EAAgE2C,MADjE,CAEPiB,CAAS,mDAA2CF,CAAI,CAAC9C,EAAhD,8CACM+C,CAAK,CAAG,CADd,mDAEQD,CAAI,CAACG,OAFb,qFAISH,CAAI,CAACI,QAJd,uDAKYJ,CAAI,CAACK,WALjB,6IAQ8CL,CAAI,CAAC9C,EARnD,eAQ0D,KAAKzC,OAAL,CAAa,EAAb,CAR1D,6CAFF,CAcb,MAAOyF,CAAAA,CACV,C,sCAKMJ,C,CAAQ,YACP3F,CADO,CAGX,GAAG2F,CAAH,CAAU,CACN,KAAKQ,IAAL,EACH,CAFD,IAEK,CACD,KAAKA,IAAL,CAAY,CACf,CACD,GAAsG,CAAC,CAAnG,IAAC,QAAD,CAAW,KAAX,EAAkBC,OAAlB,CAA0B,KAAK7F,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACM,UAAV,CAAuB,UAAjD,EAA6D+D,GAA7D,EAA1B,CAAJ,CAA0G,CACtG5C,CAAI,CAAG,MACV,CACD,GAAM8C,CAAAA,CAAU,CAAG,CACfC,EAAE,CAAE,KAAK1D,SADM,CAEf2D,OAAO,CAAEC,CAAC,CAACC,GAAF,CAAMF,OAFA,CAGfG,MAAM,CAAE,aAHO,CAIfZ,MAAM,CAAE,KAAKhC,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACS,YAApC,EAAkD4D,GAAlD,EAJO,CAKfuC,MAAM,CAAE,KAAK5E,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACM,UAAV,CAAuB,UAAjD,EAA6D+D,GAA7D,EALO,CAMfwC,QAAQ,CAAE,OANK,CAOfe,IAAI,CAAE,KAAKA,IAPI,CAQfE,OAAO,CAAE,KAAKA,OARC,CASfC,UAAU,CAAE,KAAKlC,WATF,CAUfhB,OAAO,CAAE,KAAK9D,QAAL,CAAcyD,EAVR,CAWf/C,IAAI,CAAEA,CAXS,CAYfkF,KAAK,CAAE,KAAK3E,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDS,GAArD,EAZQ,CAaf2D,KAAK,CAAE,KAAKhG,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDS,GAArD,EAbQ,CAcf4D,KAAK,CAAE,KAAKjG,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDS,GAArD,EAdQ,CAef6D,KAAK,CAAE,KAAKlG,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDS,GAArD,EAfQ,CAgBf8D,KAAK,CAAE,KAAKnG,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,yBAA1B,EAAqDS,GAArD,EAhBQ,CAAnB,CAkBA,KAAKrC,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACW,YAApC,EAAkDiD,IAAlD,CAAuD,mCAAvD,EAA0FwE,MAA1F,GACAlD,UAAEC,IAAF,CAAO,CACHC,GAAG,CAAEV,CAAC,CAACC,GAAF,CAAMU,OAAN,CAAgB,2BADlB,CAEHC,MAAM,CAAE,MAFL,CAGHC,QAAQ,CAAE,MAHP,CAIHC,IAAI,CAAEC,iBAAiB,CAAClB,CAAD,CAJpB,CAKHmB,OAAO,CAAE,iBAACC,CAAD,CAAoB,CACzB,GAAIA,CAAM,CAACC,KAAX,CAAkB,CACd,MAAO1C,WAAaC,SAAb,CAAuBwC,CAAvB,CACV,CACD,GAAG,CAACyB,CAAJ,CAAW,CACP,CAAI,CAACpF,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACW,YAApC,EAAkDwG,IAAlD,CAAuD,EAAvD,EACA,CAAI,CAACnF,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACW,YAApC,EAAkDyG,MAAlD,CAAyD,gCACnD,CAAI,CAACrF,OAAL,CAAa,EAAb,EAAiBsG,OAAjB,CAAyB,MAAzB,CAAiC1C,CAAM,CAACc,QAAP,CAAgB6B,UAAjD,CADmD,CACY,QADrE,CAEH,CACD,IAAK,GAAIC,CAAAA,CAAT,GAAiB5C,CAAAA,CAAM,CAACc,QAAP,CAAgB+B,KAAjC,CAAwC,CACpC,GAAMlB,CAAAA,CAAI,CAAG3B,CAAM,CAACc,QAAP,CAAgB+B,KAAhB,CAAsBD,CAAtB,CAAb,CACA,CAAI,CAACvG,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACW,YAApC,EAAkDyG,MAAlD,CAAyD,CAAI,CAACqB,UAAL,CAAgBnB,CAAhB,CAAzD,CACH,CACD,GAAMC,CAAAA,CAAK,CAAG,CAAI,CAACvF,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACW,YAApC,EAAkDiD,IAAlD,CAAuD,OAAvD,EAAgE2C,MAA9E,CACA,GAAIgB,CAAK,CAAG5B,CAAM,CAACc,QAAP,CAAgB6B,UAA5B,CAAuC,CACnC,CAAI,CAACtG,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACW,YAApC,EAAkDyG,MAAlD,CACI,4FACE,CAAI,CAACrF,OAAL,CAAa,EAAb,CADF,CACqB,iBAFzB,CAGH,CACJ,CAxBE,CAyBH6D,KAAK,CAAE,eAACG,CAAD,CAAWC,CAAX,CAAmBC,CAAnB,CAA8B,CACjC/C,UAAaC,SAAb,CAAuB8C,CAAvB,CACH,CA3BE,CA4BHC,UAAU,CAAG,qBAAM,CACf,CAAI,CAACC,YAAL,EACH,CA9BE,CAAP,EA+BGC,MA/BH,CA+BU,UAAM,CACZ,CAAI,CAACC,WAAL,EACH,CAjCD,CAkCH,C,mDAKc,CACX,KAAKrE,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,UAA1B,EAAsCF,IAAtC,EACH,C,iDAKa,CACV,KAAK1B,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B,UAA1B,EAAsCU,IAAtC,EACH,C,yDAKiB,CACd,GAAMoE,CAAAA,CAAM,CAAG,KAAK1G,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACO,WAApC,CAAf,CACA,IAAK,GAAIuG,CAAAA,CAAT,GAAc,MAAKR,gBAAnB,CAAqC,CACjC,GAAMqC,CAAAA,CAAQ,CAAI,KAAK1H,YAAL,EAAqB,KAAKqF,gBAAL,CAAsBQ,CAAtB,EAAyBtC,EAA/C,CAAqD,uBAArD,CAA6E,EAA9F,CACA,cAAEkE,CAAF,EACKtB,MADL,2BAC8B,KAAKd,gBAAL,CAAsBQ,CAAtB,EAAyBtC,EADvD,eAC8DmE,CAD9D,aAC0E,KAAKrC,gBAAL,CAAsBQ,CAAtB,EAAyB8B,IADnG,cAEH,CACJ,C,iEAKqB,CAClB,GAAMF,CAAAA,CAAM,CAAG,KAAK1G,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACQ,cAApC,CAAf,CAEA0E,UAAE2D,IAAF,CAAO,iBAAW,cAAX,CAA2B,OAA3B,CAAoC,KAApC,CAAP,EAAmDhH,IAAnD,CAAwD,SAACiH,CAAD,CAAU,CAC9D,IAAK,GAAIhC,CAAAA,CAAC,CAAG,CAAb,CAAqB,GAAL,EAAAA,CAAhB,CAA0BA,CAAC,EAA3B,CAA+B,CAC3B,cAAE4B,CAAF,EAAUtB,MAAV,CAAiB,0BAAkBN,CAAlB,QAA0BgC,CAAI,CAACT,OAAL,CAAa,KAAb,CAAoBvB,CAApB,CAA1B,CAAmD,WAApE,CACH,CACJ,CAJD,CAKH,C,iEAKqB,CAClB,GAAM4B,CAAAA,CAAM,CAAG,KAAK1G,KAAL,CAAW2B,OAAX,GAAqBC,IAArB,CAA0B5D,CAAS,CAACU,eAApC,CAAf,CAEA,IAAK,GAAIoG,CAAAA,CAAT,GAAc,MAAK9F,WAAnB,CAAgC,CAC5B,cAAE0H,CAAF,EAAUtB,MAAV,2BAAmCN,CAAnC,eAAyC,KAAK9F,WAAL,CAAiB8F,CAAjB,CAAzC,cACH,CAEJ,C,uBAGe,QAAP5F,CAAAA,IAAO,CAAA6H,CAAM,CAAI,CACzB,GAAInI,CAAAA,CAAJ,CAAsBmI,CAAtB,CACJ,C","sourcesContent":["'use strict';\n/**\n * ESCO Enrolment AMD module.\n *\n * @module     enrol_simplesco/userenrolment\n * @package    enrol_simplesco\n * @copyright  2016 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport {get_string, get_strings} from 'core/str';\nimport Notification from 'core/notification';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\n\nconst SELECTORS = {\n    BUTTON_TRIGGER: \"button#enrol_simplesco_adduser\",\n    BUTTON_COLLAPSE: '.collapsible .ftoggler a',\n    BUTTON_LOADMORE: 'button[data-toggle=\"load-more\"]',\n    BUTTON_ENROL: 'button[data-toggle=\"enrol\"]',\n    BUTTON_SEARCH: 'button#search',\n    FIELD_TYPE: 'input[name=\"enrol_simplesco_typesearch\"]',\n    FIELD_ROLES: 'select#enrol_simplesco_assignable_roles',\n    FIELD_DURATION: 'select#enrol_simplesco_assignable_duration',\n    FIELD_SEARCH: 'input#enrolusersearch',\n    FIELD_STARTDATE: 'select#enrol_simplesco_assignable_startdate',\n    AREA_RESULTS: \"div#results\",\n};\n\nclass ESCOUserEnrolment {\n    /** @var {array} */\n    strings = null;\n    /** @var {Modal} modal - */\n    modal = null;\n    /** @var {number} page - */\n    page = 0;\n    /** @var {number} perpage - */\n    perpage = 25;\n    /** @var {number} course_id - */\n    course_id = 0;\n    /** @var {number} role_default - */\n    role_default = 0;\n    /** @var {number} enrol_count - */\n    enrol_count = 0;\n    /** @var {array} assignales_roles - */\n    assignales_roles = [];\n    /** @var {array} instance - */\n    instance = [];\n    /** @var {array} start_dates - */\n    start_dates = [];\n    /** @var {boolean} require_refresh - */\n    require_refresh = false;\n    /** @var {Modal} modal */\n    modal = null;\n\n    constructor(options) {\n        this.course_id = options.course_id;\n        this.instance = options.instance;\n        this.start_dates = options.start_dates;\n        this.role_default = options.role_default;\n        this.init();\n    }\n\n    init() {\n        Promise.all([\n            get_strings([\n                {component: 'enrol', key: 'enrolusers'}, //0\n                {component: 'enrol', key: 'finishenrollingusers'},\n                {component: 'role', key: 'assignroles'},\n                {component: 'enrol', key: 'none'},\n                {component: 'enrol', key: 'enrolmentoptions'},\n                {component: 'moodle', key: 'startingfrom'},\n                {component: 'enrol', key: 'enrolperiod'},\n                {component: 'enrol', key: 'unlimitedduration'},\n                {component: 'enrol_simplesco', key: 'searchoption'},\n                {component: 'enrol_simplesco', key: 'frommyclass'},\n                {component: 'enrol_simplesco', key: 'fromnetocentre'}, //10\n                {component: 'enrol_simplesco', key: 'byname'},\n                {component: 'enrol_simplesco', key: 'fitre1name'},\n                {component: 'enrol_simplesco', key: 'fitre2name'},\n                {component: 'enrol_simplesco', key: 'fitre3name'},\n                {component: 'enrol_simplesco', key: 'fitre4name'},\n                {component: 'enrol_simplesco', key: 'fitre5name'},\n                {component: 'enrol_simplesco', key: 'fitre6name'},\n                {component: 'enrol', key: 'usersearch'},\n                {component: 'enrol_simplesco', key: 'noresultliste'},\n                {component: 'enrol_simplesco', key: 'allresultliste'}, //20\n                {component: 'enrol', key: 'ajaxxusersfound'},\n                {component: 'enrol', key: 'ajaxnext25'},\n                {component: 'enrol', key: 'enrol'},\n            ]),\n            ModalFactory.create({\n                type: ModalFactory.types.DEFAULT,\n                large: true,\n            }, undefined)])\n        .then(values => {\n            this.strings = values[0];\n            this.modal = values[1];\n\n            this.modal.setTitle(this.strings[0]);\n\n            const body = `<div class=\"form-inline mform simplesco\">\n            <div class=\"form-group\">\n            <label for=\"enrol_simplesco_assignable_roles\">${this.strings[2]} : </label>\n            <select id=\"enrol_simplesco_assignable_roles\"><option value=\"\">${this.strings[3]}</option></select>\n            </div>\n            <fieldset class=\"collapsible collapsed\" id=\"enrolment_options\">\n            <legend class=\"ftoggler\"><a href=\"#\" class=\"fheader\" role=\"button\" aria-controls=\"enrolment_options\" \n                aria-expanded=\"false\">${this.strings[4]}</a></legend>\n            <div class=\"fcontainer\">\n            <div class=\"startdate form-group\"><label for=\"enrol_simplesco_assignable_startdate\">${this.strings[5]} \n                :</label> <select id=\"enrol_simplesco_assignable_startdate\"></select></div>\n            <div class=\"duration form-group\"><label for=\"enrol_simplesco_assignable_duration\">${this.strings[6]} \n                :</label> <select id=\"enrol_simplesco_assignable_duration\"><option value=\"0\" selected=\"selected\">\n                ${this.strings[7]}</option></select></div>\n            </div>\n            </fieldset>\n            <fieldset class=\"collapsible\" id=\"enrolment_options\">\n            <legend class=\"ftoggler\"><a href=\"#\" class=\"fheader\" role=\"button\" aria-controls=\"enrolment_options\" \n                aria-expanded=\"false\">${this.strings[8]}</a></legend>\n            <div class=\"fcontainer\">\n            <div class=\"radio\"><label><input type=\"radio\" id=\"enrol_simplesco_typesearch_classe\" \n                name=\"enrol_simplesco_typesearch\" value=\"classe\" checked=\"checked\"/>${this.strings[9]}</label></div>\n            <div class=\"radio\"><label><input type=\"radio\" id=\"enrol_simplesco_typesearch_ent\" \n                name=\"enrol_simplesco_typesearch\" value=\"ent\"/>${this.strings[10]}</label></div>\n            <div class=\"radio\"><label><input type=\"radio\" id=\"enrol_simplesco_typesearch_nom\" \n                name=\"enrol_simplesco_typesearch\" value=\"nom\"/>${this.strings[11]}</label></div>\n            <div id=\"enrol_simplesco_selects\">\n            <div class=\"form-group\"><label for=\"enrol_simplesco_liste1\">${this.strings[12]} :</label>\n                <select id=\"enrol_simplesco_liste1\" name=\"code1\" style=\"max-width: 300px; width:100%;\"></select></div>\n            <div class=\"form-group\"><label for=\"enrol_simplesco_liste2\">${this.strings[13]} :</label>\n                <select id=\"enrol_simplesco_liste2\" name=\"code2\" style=\"max-width: 300px; width:100%;\"></select></div>\n            <div class=\"form-group\"><label for=\"enrol_simplesco_liste3\">${this.strings[14]} :</label>\n                <select id=\"enrol_simplesco_liste3\" name=\"code3\" style=\"max-width: 300px; width:100%;\"></select></div>\n            <div class=\"form-group\"><label for=\"enrol_simplesco_liste4\">${this.strings[15]} :</label>\n                <select id=\"enrol_simplesco_liste4\" name=\"code4\" style=\"max-width: 300px; width:100%;\"></select></div>\n            <div class=\"form-group\"><label for=\"enrol_simplesco_liste5\">${this.strings[16]} :</label>\n                <select id=\"enrol_simplesco_liste5\" name=\"code5\" style=\"max-width: 300px; width:100%;\"></select></div>\n            </div>\n            <div id=\"enrol_simplesco_input form-group\">\n            <label for=\"enrolusersearch\">${this.strings[17]} :</label>\n                <input type=\"text\" id=\"enrolusersearch\" value=\"\" class=\"form-control\" style=\"max-width: 300px; width:100%;\"/>\n            </div>\n            <div class=\"text-center\"><button class=\"btn btn-primary\" id=\"search\"> ${this.strings[18]}</button></div>\n            </div>\n            </fieldset>\n            <div id=\"results\"></div>\n            <div id=\"loading\" style=\"display:none;\">CHARGEMENT</div>\n            </div>`;\n            this.modal.setBody(body);\n\n            this.modal.setFooter(`<button class=\"btn btn-primary\" data-action=\"hide\">${this.strings[1]}</button>`);\n\n            this.modal.getRoot().on(ModalEvents.hidden, () => {\n                if(this.require_refresh){\n                    location.reload();\n                }\n            });\n\n            this.bindEvents();\n            this.displayLists();\n            this.populateRoles();\n            this.updateStartDateList();\n            this.updateDurationsList();\n        })\n        .catch(Notification.exception);\n    }\n\n    /**\n     * Bind events needed for the modal to work\n     */\n    bindEvents() {\n        document.addEventListener('click', event => {\n            if (event.target.closest(SELECTORS.BUTTON_TRIGGER)) {\n                event.preventDefault();\n                this.modal.show();\n                return;\n            }\n        });\n\n        this.modal.getBody().find(SELECTORS.FIELD_TYPE).on(\"change\", () => {\n            this.displayLists();\n        });\n\n        this.modal.getBody().find(SELECTORS.BUTTON_COLLAPSE).on(\"click\", (event) => {\n            event.preventDefault();\n            event.target.closest(\".collapsible\").classList.toggle('collapsed');\n            return false;\n        });\n\n        this.modal.getBody().find(\"#enrol_simplesco_liste1\").on(\"change\", (event) => {\n            this.refreshSearchLists(event.target);\n        });\n\n        this.modal.getBody().find(SELECTORS.BUTTON_SEARCH).on(\"click\", (event) => {\n            event.preventDefault();\n            this.search();\n            return false;\n        });\n        this.modal.getBody().find(SELECTORS.FIELD_SEARCH).on(\"keypress\", (event) => {\n            if(event.which === 13){\n                event.preventDefault();\n                this.search();\n                return false;\n            }\n        });\n\n        this.modal.getBody().on(\"click\", SELECTORS.BUTTON_LOADMORE, (event) => {\n            event.preventDefault();\n            this.search(true);\n            return false;\n        });\n        this.modal.getBody().on(\"click\", SELECTORS.BUTTON_ENROL, (event) => {\n            event.preventDefault();\n            const userid = $(event.target).attr(\"value\");\n            this.enrol(userid);\n            return false;\n        });\n    }\n\n    /**\n     * Change the display of listes based on selected search type\n     */\n    displayLists() {\n        switch (this.modal.getBody().find(SELECTORS.FIELD_TYPE + ':checked').val()) {\n            case \"classe\" :\n                this.modal.getBody().find(\"#enrol_simplesco_liste1\").closest('.form-group').show();\n                this.modal.getBody().find(\"#enrol_simplesco_liste2\").closest('.form-group').show();\n                this.modal.getBody().find(\"#enrol_simplesco_liste3\").closest('.form-group').show();\n                this.modal.getBody().find(\"#enrol_simplesco_liste4\").closest('.form-group').show();\n                this.modal.getBody().find(\"#enrol_simplesco_liste5\").closest('.form-group').hide();\n                this.refreshSearchLists();\n                break;\n            case \"ent\" :\n                this.modal.getBody().find(\"#enrol_simplesco_liste1\").closest('.form-group').show();\n                this.modal.getBody().find(\"#enrol_simplesco_liste2\").closest('.form-group').show();\n                this.modal.getBody().find(\"#enrol_simplesco_liste3\").closest('.form-group').show();\n                this.modal.getBody().find(\"#enrol_simplesco_liste4\").closest('.form-group').show();\n                this.modal.getBody().find(\"#enrol_simplesco_liste5\").closest('.form-group').show();\n                this.refreshSearchLists();\n                break;\n            case \"nom\" :\n                this.modal.getBody().find(\"#enrol_simplesco_liste1\").closest('.form-group').hide();\n                this.modal.getBody().find(\"#enrol_simplesco_liste2\").closest('.form-group').hide();\n                this.modal.getBody().find(\"#enrol_simplesco_liste3\").closest('.form-group').hide();\n                this.modal.getBody().find(\"#enrol_simplesco_liste4\").closest('.form-group').hide();\n                this.modal.getBody().find(\"#enrol_simplesco_liste5\").closest('.form-group').hide();\n                break;\n        }\n    }\n\n    /**\n     * Enrol the given userid\n     */\n    enrol(userid) {\n        const parameters = {\n            id: this.course_id,\n            sesskey: M.cfg.sesskey,\n            action: 'enrol',\n            enrolid: this.instance.id,\n            userid : userid,\n            role : this.modal.getBody().find(SELECTORS.FIELD_ROLES).val(),\n            startdate : this.modal.getBody().find(SELECTORS.FIELD_STARTDATE).val(),\n            duration : this.modal.getBody().find(SELECTORS.FIELD_DURATION).val(),\n            recovergrades : 0,\n        };\n        $.ajax({\n            url: M.cfg.wwwroot + '/enrol/simplesco/ajax.php',\n            method: 'POST',\n            dataType: 'json',\n            data: build_querystring(parameters),\n            success: (result, statut) => {\n                if (result.error) {\n                    return Notification.exception(result);\n                }\n                this.require_refresh = true;\n                this.enrol_count++;\n                this.modal.getBody().find(SELECTORS.AREA_RESULTS).find('div.user[rel=\"' + userid + '\"]').addClass(\"enrolled\");\n            },\n            error: (resultat, statut, erreur) => {\n                Notification.exception(erreur);\n            },\n            beforeSend : () => {\n                this.startLoading();\n            }\n        }).always(() => {\n            this.stopLoading();\n        });\n    }\n\n    /**\n     * Load the list of roles from the database for given course\n     */\n    populateRoles() {\n        if (this.assignales_roles.length > 0) {\n            return this.updateRolesList();\n        }\n        $.ajax({\n            url: M.cfg.wwwroot + '/enrol/ajax.php',\n            method: 'POST',\n            dataType: 'json',\n            data: 'id=' + this.course_id + '&action=getassignable&sesskey=' + M.cfg.sesskey,\n            success: (result, statut) => {\n                if (result.error) {\n                    return Notification.exception(result);\n                }\n                this.assignales_roles = result.response;\n                this.updateRolesList();\n            },\n            error: (resultat, statut, erreur) => {\n                Notification.exception(erreur);\n            },\n            beforeSend : () => {\n                this.startLoading();\n            }\n        }).always(() => {\n            this.stopLoading();\n        });\n    }\n\n    /**\n     * Based on the type of search, refresh content of search lists\n     */\n    refreshSearchLists(listes) {\n        let code1 = this.modal.getBody().find(\"select#enrol_simplesco_liste1\").val();\n        if (listes == undefined) {\n            listes = \"12345\";\n        } else if (typeof(listes) == \"object\") {\n            listes = '345';\n        }\n        if (code1 === null) {\n            code1 = \"\";\n        }\n        const parameters = {\n            id: this.course_id,\n            action: 'getListes',\n            sesskey: M.cfg.sesskey,\n            code1: code1,\n            option: this.modal.getBody().find(SELECTORS.FIELD_TYPE + ':checked').val(),\n            numliste: listes\n        };\n        $.ajax({\n            url: M.cfg.wwwroot + '/enrol/simplesco/ajax.php',\n            method: 'POST',\n            dataType: 'json',\n            data: build_querystring(parameters),\n            success: (result, statut) => {\n                if (result.error) {\n                    return Notification.exception(result);\n                }\n                for (let i = 0; i < parameters.numliste.length; i++) {\n                    const id_liste = parameters.numliste.charAt(i);\n                    const $liste = this.modal.getBody().find(\"#enrol_simplesco_liste\" + id_liste);\n                    const value = result.response[\"defaut\" + id_liste];\n                    $liste.html(\"\");\n                    if (result.response[id_liste].length == 0) {\n                        $liste.append(`<option value=\"\">${this.strings[19]}</option>`);\n                    } else {\n                        for (let j in result.response[id_liste]) {\n                            $liste.append(`<option value=\"${j}\">${result.response[id_liste][j]}</option>`);\n                        }\n                        if (id_liste != 1) {\n                            $liste.append(`<option value=\"\">${this.strings[20]}</option>`);\n                        }\n                    }\n                    $liste.val(value);\n                }\n            },\n            error: (resultat, statut, erreur) => {\n                Notification.exception(erreur);\n            },\n            beforeSend : () => {\n                this.startLoading();\n            }\n        }).always(() => {\n            this.stopLoading();\n        });\n    }\n\n    /**\n     * Render user data to HTML format\n     * @param user\n     */\n    renderUser(user) {\n        const count = this.modal.getBody().find(SELECTORS.AREA_RESULTS).find(\".user\").length;\n        const user_html = `<div class=\"user item clearfix\" rel=\"${user.id}\">\n        <div class=\"count\">${count + 1}</div>\n        <div class=\"picture\">${user.picture}</div>\n        <div class=\"details\">\n        <div class=\"fullname\">${user.fullname}</div>\n        <div class=\"extrafields\">${user.extrafields}</div>\n        </div>\n        <div class=\"options\">\n        <button class=\"btn btn-success\" data-toggle=\"enrol\" value=\"${user.id}\">${this.strings[23]}</button>\n        </div>\n        </div>`;\n\n        return user_html;\n    }\n\n    /**\n     * Send the send request to server(s) and then process the results\n     */\n    search(append) {\n        let type;\n\n        if(append){\n            this.page++;\n        }else{\n            this.page = 0;\n        }\n        if ([\"classe\", \"ent\"].indexOf(this.modal.getBody().find(SELECTORS.FIELD_TYPE + ':checked').val()) !== -1) {\n            type = 'ldap';\n        }\n        const parameters = {\n            id: this.course_id,\n            sesskey: M.cfg.sesskey,\n            action: 'searchusers',\n            search: this.modal.getBody().find(SELECTORS.FIELD_SEARCH).val(),\n            option: this.modal.getBody().find(SELECTORS.FIELD_TYPE + ':checked').val(),\n            numliste: \"12345\",\n            page: this.page,\n            perpage: this.perpage,\n            enrolcount: this.enrol_count,\n            enrolid: this.instance.id,\n            type: type,\n            code1: this.modal.getBody().find(\"#enrol_simplesco_liste1\").val(),\n            code2: this.modal.getBody().find(\"#enrol_simplesco_liste2\").val(),\n            code3: this.modal.getBody().find(\"#enrol_simplesco_liste3\").val(),\n            code4: this.modal.getBody().find(\"#enrol_simplesco_liste4\").val(),\n            code5: this.modal.getBody().find(\"#enrol_simplesco_liste5\").val(),\n        };\n        this.modal.getBody().find(SELECTORS.AREA_RESULTS).find('button[data-toggle=\"load-more\"]').remove();\n        $.ajax({\n            url: M.cfg.wwwroot + '/enrol/simplesco/ajax.php',\n            method: 'POST',\n            dataType: 'json',\n            data: build_querystring(parameters),\n            success: (result, statut) => {\n                if (result.error) {\n                    return Notification.exception(result);\n                }\n                if(!append){\n                    this.modal.getBody().find(SELECTORS.AREA_RESULTS).html(\"\");\n                    this.modal.getBody().find(SELECTORS.AREA_RESULTS).append('<div class=\"total_results\">'\n                        + this.strings[21].replace(\"{$a}\", result.response.totalusers) + '</div>');\n                }\n                for (let line in result.response.users) {\n                    const user = result.response.users[line];\n                    this.modal.getBody().find(SELECTORS.AREA_RESULTS).append(this.renderUser(user));\n                }\n                const count = this.modal.getBody().find(SELECTORS.AREA_RESULTS).find(\".item\").length;\n                if (count < result.response.totalusers){\n                    this.modal.getBody().find(SELECTORS.AREA_RESULTS).append(\n                        '<div class=\"text-center\"><button class=\"btn btn-secondary\" data-toggle=\"load-more\">'\n                        + this.strings[22] + '</button></div>');\n                }\n            },\n            error: (resultat, statut, erreur) => {\n                Notification.exception(erreur);\n            },\n            beforeSend : () => {\n                this.startLoading();\n            }\n        }).always(() => {\n            this.stopLoading();\n        });\n    }\n\n    /**\n     * Display the loading screen\n     */\n    startLoading() {\n        this.modal.getBody().find(\"#loading\").show();\n    }\n\n    /**\n     * Show the loading screen\n     */\n    stopLoading() {\n        this.modal.getBody().find(\"#loading\").hide();\n    }\n\n    /**\n     * Update the roles select field\n     */\n    updateRolesList() {\n        const select = this.modal.getBody().find(SELECTORS.FIELD_ROLES);\n        for (let i in this.assignales_roles) {\n            const selected = (this.role_default == this.assignales_roles[i].id) ? 'selected=\"selected\"' : \"\";\n            $(select)\n                .append(`<option value=\"${this.assignales_roles[i].id}\" ${selected}>${this.assignales_roles[i].name}</option>`);\n        }\n    }\n\n    /**\n     * Update the durations select field\n     */\n    updateDurationsList() {\n        const select = this.modal.getBody().find(SELECTORS.FIELD_DURATION);\n\n        $.when(get_string('durationdays', 'enrol', '{a}')).then((text) => {\n            for (let i = 1; i <= 365; i++) {\n                $(select).append(`<option value=\"${i}\">` + text.replace('{a}', i) + '</option>');\n            }\n        });\n    }\n\n    /**\n     * Update the start date select field\n     */\n    updateStartDateList() {\n        const select = this.modal.getBody().find(SELECTORS.FIELD_STARTDATE);\n\n        for (let i in this.start_dates) {\n            $(select).append(`<option value=\"${i}\">${this.start_dates[i]}</option>`);\n        }\n\n    }\n}\n\nexport const init = config => {\n    (new ESCOUserEnrolment(config));\n};"],"file":"userenrolment.min.js"}